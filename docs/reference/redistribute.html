<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Distribute data from a source frame to a target frame."><title>Redistribute Data — redistribute • redistribute</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Redistribute Data — redistribute"><meta property="og:description" content="Distribute data from a source frame to a target frame."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">redistribute</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/estimate_comparisons.html">Method Comparisons</a>
    <a class="dropdown-item" href="../articles/household_estimates.html">Household Estimates</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/uva-bi-sdad/redistribute/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Redistribute Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/uva-bi-sdad/redistribute/blob/HEAD/R/redistribute.R" class="external-link"><code>R/redistribute.R</code></a></small>
      <div class="d-none name"><code>redistribute.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Distribute data from a source frame to a target frame.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">redistribute</span><span class="op">(</span><span class="va">source</span>, target <span class="op">=</span> <span class="cn">NULL</span>, map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, source_id <span class="op">=</span> <span class="st">"GEOID"</span>,</span>
<span>  target_id <span class="op">=</span> <span class="va">source_id</span>, weight <span class="op">=</span> <span class="cn">NULL</span>, source_variable <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  source_value <span class="op">=</span> <span class="cn">NULL</span>, aggregate <span class="op">=</span> <span class="cn">NULL</span>, weight_agg_method <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  default_value <span class="op">=</span> <span class="cn">NA</span>, outFile <span class="op">=</span> <span class="cn">NULL</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  make_intersect_map <span class="op">=</span> <span class="cn">FALSE</span>, fill_targets <span class="op">=</span> <span class="cn">FALSE</span>, overlaps <span class="op">=</span> <span class="st">"keep"</span>,</span>
<span>  use_all <span class="op">=</span> <span class="cn">TRUE</span>, return_geometry <span class="op">=</span> <span class="cn">TRUE</span>, return_map <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>source</dt>
<dd><p>A matrix-like object you want to distribute from; usually this will be
the real or more complete dataset, and is often at a lower resolution / higher level.</p></dd>


<dt>target</dt>
<dd><p>A matrix-like object you want to distribute to: usually this will be
the dataset you want but isn't available, and is often at a higher resolution / lower level
(for disaggregation). Can also be a single number, representing the number of initial
characters of <code>source</code> IDs to derive target IDs from (useful for aggregating up nested groups).</p></dd>


<dt>map</dt>
<dd><p>A list with entries named with <code>source</code> IDs (or aligning with those IDs),
containing vectors of associated <code>target</code> IDs (or indices of those IDs). Entries
can also be numeric vectors with IDs as names, which will be used to weigh the relationship.
If IDs are related by substrings (the first characters of <code>target</code> IDs are <code>source</code> IDs),
then a map can be automatically generated from them. If <code>source</code> and <code>target</code>
contain <code>sf</code> geometries, a map will be made with <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></code>
(<code>st_intersects(source, target)</code>). If an intersects map is made, and <code>source</code>
is being aggregated to <code>target</code>, and map entries contain multiple target IDs,
those entries will be weighted by their proportion of overlap with the source area.</p></dd>


<dt>source_id, target_id</dt>
<dd><p>Name of a column in <code>source</code> / <code>target</code>,
or a vector containing IDs. For <code>source</code>, this will default to the first column. For
<code>target</code>, columns will be searched through for one that appears to relate to the
source IDs, falling back to the first column.</p></dd>


<dt>weight</dt>
<dd><p>Name of a column, or a vector containing weights (or single value to apply to all cases),
which apply to <code>target</code> when disaggregating, and <code>source</code> when aggregating.
Defaults to unit weights (all weights are 1).</p></dd>


<dt>source_variable, source_value</dt>
<dd><p>If <code>source</code> is tall (with variables spread across
rows rather than columns), specifies names of columns in <code>source</code> containing variable names
and values for conversion.</p></dd>


<dt>aggregate</dt>
<dd><p>Logical; if specified, will determine whether to aggregate or disaggregate
from <code>source</code> to <code>target</code>. Otherwise, this will be <code>TRUE</code> if there are more
<code>source</code> observations than <code>target</code> observations.</p></dd>


<dt>weight_agg_method</dt>
<dd><p>Means of aggregating <code>weight</code>, in the case that target IDs contain duplicates.
Options are <code>"sum"</code>, <code>"average"</code>, or <code>"auto"</code> (default; which will sum if <code>weight</code>
is integer-like, and average otherwise).</p></dd>


<dt>default_value</dt>
<dd><p>Value to set to any unmapped target ID.</p></dd>


<dt>outFile</dt>
<dd><p>Path to a CSV file in which to save results.</p></dd>


<dt>overwrite</dt>
<dd><p>Logical; if <code>TRUE</code>, will overwrite an existing <code>outFile</code>.</p></dd>


<dt>make_intersect_map</dt>
<dd><p>Logical; if <code>TRUE</code>, will opt to calculate an intersect-based map
rather than an ID-based map, if both seem possible. If specified as <code>FALSE</code>, will
never calculate an intersect-based map.</p></dd>


<dt>fill_targets</dt>
<dd><p>Logical; if <code>TRUE</code>, will make new <code>target</code> rows for any
un-mapped <code>source</code> row.</p></dd>


<dt>overlaps</dt>
<dd><p>If specified and not <code>TRUE</code> or <code>"keep"</code> (default), will assign <code>target</code>
entities that are mapped to multiple <code>source</code> entities to a single source entity. The value
determines how entities with the same weight should be assigned, between <code>"first"</code>,
<code>"last"</code>, and <code>"random"</code>.</p></dd>


<dt>use_all</dt>
<dd><p>Logical; if <code>TRUE</code> (default), will redistribute map weights so they sum to 1.
Otherwise, entities may be partially weighted.</p></dd>


<dt>return_geometry</dt>
<dd><p>Logical; if <code>FALSE</code>, will not set the returned <code>data.frame</code>'s
geometry to that of <code>target</code>, if it exists.</p></dd>


<dt>return_map</dt>
<dd><p>Logical; if <code>TRUE</code>, will only return the map, without performing the
redistribution. Useful if you want to inspect an automatically created map, or use it in a later call.</p></dd>


<dt>verbose</dt>
<dd><p>Logical; if <code>TRUE</code>, will show status messages.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code>data.frame</code> with a row for each <code>target_ids</code> (identified by the first column,
<code>id</code>), and a column for each variable from <code>source</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># minimal example</span></span></span>
<span class="r-in"><span><span class="va">source</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="fu">redistribute</span><span class="op">(</span><span class="va">source</span>, <span class="va">target</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> source IDs: <span style="color: #00BB00;">1</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> target IDs: `target` vector</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> map: all target IDs for single source</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> weights: <span style="color: #00BB00;">1</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> redistributing <span style="color: #00BB00;">2</span> variables from <span style="color: #00BB00;">1</span> source to <span style="color: #00BB00;">5</span> targets:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> (numb; 2) a, b</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> disaggregating...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done disaggregating <span style="color: #B2B2B2;">[8ms]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id   a   b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1 0.2 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2 0.2 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  3 0.2 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4 0.2 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  5 0.2 0.4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># multi-entity example</span></span></span>
<span class="r-in"><span><span class="va">source</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aaa"</span>, <span class="st">"bbb"</span><span class="op">)</span>, num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">1e5</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="fu">redistribute</span><span class="op">(</span><span class="va">source</span>, <span class="va">target</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> source IDs: <span style="color: #00BB00;">id</span> column of `source`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> target IDs: <span style="color: #00BB00;">id</span> column of `target`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> map: first <span style="color: #00BB00;">1</span> character of target IDs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> weights: <span style="color: #00BB00;">1</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> redistributing <span style="color: #00BB00;">2</span> variables from <span style="color: #00BB00;">2</span> sources to <span style="color: #00BB00;">10</span> targets:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> (numb; 1) num</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> (char; 1) cat</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> disaggregating...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> done disaggregating <span style="color: #B2B2B2;">[7ms]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> re-converting categorical levels</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    id cat num</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  a4 aaa 0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  b4 bbb 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  b5 bbb 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  b1 bbb 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  a2 aaa 0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  b3 bbb 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  b2 bbb 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  a1 aaa 0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  a5 aaa 0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 a3 aaa 0.2</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://biocomplexity.virginia.edu/institute/divisions/social-and-decision-analytics" class="external-link">Biocomplexity Institute</a>, Micah Iserman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>


<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<style>body{background-color:white;}</style>
<script src="lib/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="lib/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="lib/datatables-binding-0.26/datatables.js"></script>
<script src="lib/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="lib/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="lib/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="lib/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="lib/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="lib/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="lib/highlight.js-6.2/rstudio.css" rel="stylesheet" />
<script src="lib/highlight.js-6.2/highlight.pack.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="lib/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<link href="lib/bootstrap-3.3.5/css/bootstrap-theme.min.css" rel="stylesheet" />
<script src="lib/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="lib/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="lib/bootstrap-3.3.5/shim/respond.min.js"></script>

</head>
<body>
<div class="container-fluid">
  <style type="text/css">table tr:hover td {
  font-weight:bold;text-decoration:none
}
table tr.covered td{
  background-color:rgba(95,151,68,0.3)
}

table tr:hover.covered .num{
  background-color:rgba(95,151,68,0.7)
}
table tr.missed td{
  background-color:rgba(185,73,71,0.3)
}
table tr:hover.missed .num{
  background-color:rgba(185,73,71,0.7)
}

table tr.missed:hover td{
  -webkit-box-shadow:0 -2px 0 0 #b94947 inset;
  -moz-box-shadow:0 -2px 0 0 #b94947 inset;
  box-shadow:0 -2px 0 0 #b94947 inset
}
table tr.covered:hover td{
  -webkit-box-shadow:0 -2px 0 0 #5f9744 inset;
  -moz-box-shadow:0 -2px 0 0 #5f9744 inset;
  box-shadow:0 -2px 0 0 #5f9744 inset
}

table tr.never td{
  background-color:transparent
}

table tbody {
  border-style: solid;
  border: 1px solid rgba(0,0,0,0.1)
}

table .num {
  border-right: 1px solid rgba(0,0,0,0.1)
}

td.coverage em {
  opacity: 0.5;
}

table td.coverage {
  border-right: 1px solid rgba(0,0,0,0.1);
  font-weight: bold;
  text-align: center;
}
table.table-condensed pre {
  background-color: transparent;
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 11px;
}
div#files td {
  padding: 0;
  padding-left: 5px;
}

div#files td.num {
  padding-right: 5px;
}

table.table-condensed {
  font-size: 11px;
}</style>
  <div class="col-md-8 col-md-offset-2">
    <h2>redistribute coverage - 71.35%</h2>
    <div class="tabbable">
      <ul class="nav nav-tabs" data-tabsetid="covr">
        <li class="active">
          <a href="#tab-covr-1" data-toggle="tab" data-value="Files">Files</a>
        </li>
        <li>
          <a href="#tab-covr-2" data-toggle="tab" data-value="Source">Source</a>
        </li>
      </ul>
      <div class="tab-content" data-tabsetid="covr">
        <div class="tab-pane active" title="Files" data-value="Files" id="tab-covr-1">
          <div id="htmlwidget-36ece9f1d937811ce9e8" style="width:100%;height:500px;" class="datatables html-widget"></div>
          <script type="application/json" data-for="htmlwidget-36ece9f1d937811ce9e8">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["<a href=\"#\">R/redistribute.R<\/a>","<a href=\"#\">src/redistribute.cpp<\/a>"],[333,221],[219,127],[134,111],[85,16],["4","28"],["61.19%","87.40%"]],"container":"<table class=\"row-border\">\n  <thead>\n    <tr>\n      <th>File<\/th>\n      <th>Lines<\/th>\n      <th>Relevant<\/th>\n      <th>Covered<\/th>\n      <th>Missed<\/th>\n      <th>Hits / Line<\/th>\n      <th>Coverage<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"dom":"t","paging":false,"columnDefs":[{"targets":6,"createdCell":"function(td, cellData, rowData, row, col) {\n  var percent = cellData.replace(\"%\", \"\");\n  if (percent > 90) {\n    var grad = \"linear-gradient(90deg, #edfde7 \" + cellData + \", white \" + cellData + \")\";\n  } else if (percent > 75) {\n    var grad = \"linear-gradient(90deg, #f9ffe5 \" + cellData + \", white \" + cellData + \")\";\n  } else {\n    var grad = \"linear-gradient(90deg, #fcece9 \" + cellData + \", white \" + cellData + \")\";\n  }\n  $(td).css(\"background\", grad);\n}\n"},{"className":"dt-right","targets":[1,2,3,4]}],"order":[],"autoWidth":false,"orderClasses":false},"callback":"function(table) {\ntable.on('click.dt', 'a', function() {\n  files = $('div#files div');\n  files.not('div.hidden').addClass('hidden');\n  id = $(this).text();\n  files.filter('div[id=\\'' + id + '\\']').removeClass('hidden');\n  $('ul.nav a[data-value=Source]').text(id).tab('show');\n});\n}"},"evals":["options.columnDefs.0.createdCell","callback"],"jsHooks":[]}</script>
        </div>
        <div class="tab-pane" title="Source" data-value="Source" id="tab-covr-2">
          <div id="files">
            <div id="R/redistribute.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Redistribute Data</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Distribute data from a source frame to a target frame.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param source A matrix-like object you want to distribute from; usually this will be</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the real or more complete dataset, and is often at a lower resolution / higher level.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param target A matrix-like object you want to distribute to: usually this will be</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the dataset you want but isn't available, and is often at a higher resolution / lower level.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param map A list with entries named with \code{source} IDs (or aligning with those IDs),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' containing vectors of associated \code{target} IDs (or indices of those IDs). If IDs</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' are related by substrings (the first characters of \code{target} IDs are \code{source} IDs),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' then a map can be automatically generated from them. If \code{source} and \code{target}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' contain \code{sf} geometries, a map will be made with \code{\link[sf]{st_intersects}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (\code{st_intersects(source, target)}).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param source_id,target_id Name of a column in \code{source} / \code{target},</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' or a vector containing IDs. For \code{source}, this will default to the first column. For</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{target}, columns will be searched through for one that appears to relate to the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source IDs, falling back to the first column.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param weight Name of a column, or a vector containing weights (or single value to apply to all cases),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' which apply to \code{target} when disaggregating, and \code{source} when aggregating.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Defaults to unit weights (all weights are 1).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param source_variable,source_value If \code{source} is tall (with variables spread across</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' rows rather than columns), specifies names of columns in \code{source} containing variable names</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' and values for conversion.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param weight_agg_method Means of aggregating \code{weight}, in the case that target IDs contain duplicates.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Options are \code{"sum"}, \code{"average"}, or \code{"auto"} (default; which will sum if \code{weight}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' is integer-like, and average otherwise).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param outFile Path to a CSV file in which to save results.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param overwrite Logical; if \code{TRUE}, will overwrite an existing \code{outFile}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param verbose Logical; if \code{TRUE}, will show status messages.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' # minimal example</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source &lt;- c(a = 1, b = 2)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' target &lt;- 1:5</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">35</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (redistribute(source, target, verbose = TRUE))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' # multi-entity example</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source &lt;- data.frame(id = c("a", "b"), cat = c("aaa", "bbb"), num = c(1, 2))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' target &lt;- data.frame(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   id = sample(paste0(c("a", "b"), rep(1:5, 2))),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   population = sample.int(1e5, 10)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (redistribute(source, target, verbose = TRUE))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @returns A \code{data.frame} with a row for each \code{target_ids} (identified by the first column,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{id}), and a column for each variable from \code{source}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom cli cli_abort cli_bullets cli_alert_info</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom Rcpp sourceCpp</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom RcppParallel RcppParallelLibs</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">49</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom utils write.csv</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_intersects st_geometry&lt;-</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @useDynLib redistribute, .registration = TRUE</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">52</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">redistribute &lt;- function(source, target = NULL, map = list(), source_id = "GEOID", target_id = source_id,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         weight = NULL, source_variable = NULL, source_value = NULL, weight_agg_method = "auto",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         outFile = NULL, overwrite = FALSE, verbose = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">57</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!overwrite &amp;&amp; !is.null(outFile) &amp;&amp; file.exists(outFile)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">58</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_abort("{.arg outFile} already exists; use {.code overwrite = TRUE} to overwrite it")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  source_sf &lt;- inherits(source, "sf")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">61</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  target_sf &lt;- inherits(target, "sf")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">62</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  intersect_map &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">63</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(dim(source)) != 2) source &lt;- t(source)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">64</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (is.null(colnames(source))) colnames(source) &lt;- paste0("V", seq_len(ncol(source)))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">65</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(source_id) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">66</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("source IDs: {.arg source_id} vector")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">67</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sid &lt;- source_id</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">68</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (source_id %in% colnames(source)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">69</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("source IDs: {.field {source_id}} column of {.arg source}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sid &lt;- source[, source_id, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">71</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source &lt;- source[, colnames(source) != source_id]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">72</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (nrow(source) == 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">73</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("source IDs: {.field 1}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">74</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sid &lt;- if (missing(source_id)) "1" else source_id</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">76</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (source_sf &amp;&amp; target_sf) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">77</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("source IDs: sequence, assuming map from geometries")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">78</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      intersect_map &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">79</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sid &lt;- seq_len(nrow(source))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">81</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("source IDs: {.field {colnames(source)[1]}} column of {.arg source}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sid &lt;- source[, 1, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">83</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      source &lt;- source[, -1, drop = FALSE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">85</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sid &lt;- as.character(sid)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">87</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(sid) != nrow(source)) cli_abort("{.arg source_id} is not the same length as {.field nrow(source)}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">88</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (anyDuplicated(sid)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">89</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(source_variable)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">90</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if ("variable" %in% colnames(source)) source_variable &lt;- "variable"</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">91</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if ("measure" %in% colnames(source)) source_variable &lt;- "measure"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">92</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">93</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(source_value)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if ("value" %in% colnames(source)) source_value &lt;- "value"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">96</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(source_variable) || !is.null(source_value)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">98</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source_numeric &lt;- vapply(seq_len(ncol(source)), function(col) is.numeric(source[, col, drop = TRUE]), TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">99</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(source_value) &amp;&amp; any(source_numeric)) source_value &lt;- colnames(source)[which(source_numeric)[1]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(source_variable) &amp;&amp; any(!source_numeric)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">101</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      source_variable &lt;- colnames(source)[</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">102</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        which.min(vapply(which(!source_numeric), function(col) length(unique(source[, col])), 0))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">103</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">104</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">105</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">106</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_alert_info(paste(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">107</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "converting {.arg source} format, breaking",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">108</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (length(source_value) == 1) "{.field {source_value}}" else "{.arg source_value}",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">109</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "values across",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">110</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (length(source_variable) == 1) "{.field {source_variable}}" else "{.arg source_variable}",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">111</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "columns"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">112</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">113</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">114</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    usid &lt;- unique(sid)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">115</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    nr &lt;- nrow(source)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">116</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(source_value) != nr) source_value &lt;- source[, source_value, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(source_variable) != nr) source_variable &lt;- source[, source_variable, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">118</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ss &lt;- split(data.frame(sid, source_value), source_variable)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">119</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source &lt;- do.call(cbind, lapply(ss, function(vd) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vd &lt;- vd[!duplicated(vd[[1]]), ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">121</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      rownames(vd) &lt;- vd[, 1]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">122</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vd[usid, 2, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">123</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    colnames(source) &lt;- names(ss)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">125</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source &lt;- as.data.frame(source)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">126</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sid &lt;- usid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">127</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">128</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(dim(target)) == 2 &amp;&amp; is.null(colnames(target))) colnames(target) &lt;- paste0("V", seq_len(ncol(target)))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">129</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(target_id) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">130</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("target IDs: {.arg target_id} vector")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">131</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- target_id</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (is.null(target)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">133</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("target IDs: {.field 1}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">134</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">135</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (!is.null(target_id) &amp;&amp; length(dim(target)) == 2 &amp;&amp; target_id %in% colnames(target)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">136</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("target IDs: {.field {target_id}} column of {.arg target}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- target[, target_id, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    target &lt;- target[, colnames(target) != target_id]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">139</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(dim(target)) != 2) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">141</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (is.null(weight) &amp;&amp; is.numeric(target) &amp;&amp; !is.null(names(target))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">142</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("target IDs: names of {.arg target} vector; {.arg weight} set to {.arg target}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">143</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        weight &lt;- unname(target)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">144</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        tid &lt;- names(target)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">145</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">146</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("target IDs: {.arg target} vector")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">147</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        tid &lt;- target</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">148</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">149</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">150</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (target_sf &amp;&amp; source_sf) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">151</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("target IDs: sequence, assuming map from geometries")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">152</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        intersect_map &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">153</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        tid &lt;- seq_len(nrow(target))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">154</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">155</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        idi &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">156</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (length(map)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">157</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          tids &lt;- unique(unlist(map, use.names = FALSE))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">158</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (i in seq_len(ncol(target))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">159</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (any(target[, i] %in% tids)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">160</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              idi &lt;- i</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">161</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              break</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">162</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">163</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">164</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else if (all(nchar(sid) == nchar(sid[1]))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">165</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          sl &lt;- nchar(sid[1])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (i in seq_len(ncol(target))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">167</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (any(substr(target[, i], 1, sl) %in% sid)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">168</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              idi &lt;- i</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">169</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              break</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">170</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">171</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">172</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">173</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("target IDs: {.field {colnames(target)[idi]}} column of {.arg target}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        tid &lt;- target[, idi, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">175</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        target &lt;- target[, -idi, drop = FALSE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">176</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">177</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">178</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">179</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tid &lt;- as.character(tid)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">180</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  aggregate &lt;- length(sid) &gt; length(tid)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">181</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!aggregate &amp;&amp; anyDuplicated(sid)) cli_abort("")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">182</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(map)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">183</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("map: provided list")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">184</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(names(map))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">185</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (length(map) != length(sid)) cli_abort("{.arg map} has no names, and is not the same length as source IDs")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">186</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      names(map) &lt;- sid</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">187</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (!any(sid %in% names(map))) cli_abort("no source IDs were present in the ID map")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">188</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">189</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (nrow(source) == 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">190</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("map: all target IDs for single source")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">191</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map[[sid]] &lt;- tid</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">192</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (is.null(target) || length(tid) == 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">193</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("map: all source IDs to a single target")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">194</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- as.list(structure(rep(tid, length(sid)), names = sid))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">195</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (aggregate &amp;&amp; !intersect_map &amp;&amp; all(nchar(tid) == nchar(tid[1])) &amp;&amp; nchar(sid[1]) &gt; nchar(tid[1])) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">196</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("map: first {.field {nchar(sid[1])}} character{?s} of source IDs")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">197</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- as.list(structure(substr(sid, 1, nchar(tid[1])), names = sid))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (!intersect_map &amp;&amp; all(nchar(sid) == nchar(sid[1])) &amp;&amp; nchar(tid[1]) &gt; nchar(sid[1])) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">199</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("map: first {.field {nchar(sid[1])}} character{?s} of target IDs")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">200</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- split(tid, substr(tid, 1, nchar(sid[1])))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">201</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (source_sf &amp;&amp; target_sf) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">202</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("map: intersections between geometries")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">203</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      op &lt;- options(sf_use_s2 = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">204</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      on.exit(options(sf_use_s2 = op[[1]]))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">205</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- tryCatch(st_intersects(source, target), error = function(e) NULL)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">206</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (is.null(map)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">207</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_abort(c(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">208</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          x = "{.fn st_intersects} failed between {.arg source} and {.arg target}",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">209</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          i = "if you can do this or similar separetely, you can pass the result as {.arg map}"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">210</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">211</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">212</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      names(map) &lt;- sid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">213</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">214</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_abort("no map was provided, and could not make one from IDs")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">215</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">216</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">217</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (aggregate &amp;&amp; length(map) == length(tid)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">218</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(names(map))) names(map) &lt;- seq_along(map)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">219</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    map &lt;- as.list(structure(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">220</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      unlist(map, use.names = FALSE),</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">221</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      names = rep(names(map), vapply(map, length, 0))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">222</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">223</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">224</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  map &lt;- lapply(sid, function(id) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">225</td>
                    <td class="coverage">34<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    e &lt;- map[[id]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">226</td>
                    <td class="coverage">34<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(e)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">227</td>
                    <td class="coverage">34<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (aggregate &amp;&amp; length(e) != 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">228</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_abort(c(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">229</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          x = "decided to aggregate, but ID {id} does not map to a single target",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">230</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          i = "if {.arg source} is tall, specify {.arg source_variable} or {.arg source_value}} to convert it"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">231</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">232</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">233</td>
                    <td class="coverage">30<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (is.integer(e)) tid[e] else e</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">234</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">235</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      character()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">236</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">237</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  })</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">238</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  nout &lt;- length(if (aggregate) sid else tid)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">239</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  w &lt;- if (length(weight) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">240</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("weights: {.arg weight} vector")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">241</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(weight) != nout) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">242</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_abort("{.arg weight} is not the same length as {.arg {if (aggregate) 'source' else 'target'}} IDs")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">243</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">244</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    weight</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">245</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if ((aggregate &amp;&amp; (is.null(weight) || !weight %in% colnames(source))) || length(dim(target)) != 2) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">246</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    weight &lt;- if (!is.numeric(weight)) 1 else weight</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">247</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("weights: {.field {weight}}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">248</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rep(weight, nout)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">249</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (aggregate &amp;&amp; !is.null(weight)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">250</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("weights: {.field {weight}} column of {.arg source}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">251</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    w &lt;- source[, weight, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">252</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source &lt;- source[, colnames(weight) != weight, drop = FALSE]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">253</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    w</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">254</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">255</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!is.null(weight) &amp;&amp; weight %in% colnames(target)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">256</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("weights: {.field {weight}} column of {.arg target}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">257</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      target[, weight, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">258</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">259</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      su &lt;- vapply(seq_len(ncol(target)), function(col) is.numeric(target[, col, drop = TRUE]), TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">260</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (any(su)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">261</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        weight &lt;- colnames(target)[which(su)[1]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">262</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("weights: {.field {weight}} column of {.arg target}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">263</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        target[, weight, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">264</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">265</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("weights: {.field 1}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">266</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        rep(1, length(tid))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">267</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">268</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">269</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">270</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  w &lt;- as.numeric(w)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">271</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  realign &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">272</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!aggregate &amp;&amp; anyDuplicated(tid)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">273</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    realign &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">274</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    otid &lt;- tid</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">275</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    agger &lt;- if (weight_agg_method == "auto") {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">276</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (all(w == as.integer(w))) "summing" else "averaging"</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">277</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (grepl("^[Ss]", weight_agg_method)) "summing" else "averaging"</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">278</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("{.arg target_id} contains duplicates, so {agger} {.arg weight}s")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">279</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    w &lt;- tapply(w, tid, if (agger == "summing") sum else mean)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">280</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- names(w)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">281</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    w &lt;- unname(w)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">282</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">283</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (source_sf) st_geometry(source) &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">284</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  source_numeric &lt;- vapply(seq_len(ncol(source)), function(col) is.numeric(source[, col, drop = TRUE]), TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">285</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!all(source_numeric)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">286</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    non_numeric &lt;- which(!source_numeric)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">287</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    level_map &lt;- list()</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">288</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (col in non_numeric) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">289</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      x &lt;- as.factor(source[, col, drop = TRUE])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">290</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      source[, col] &lt;- as.numeric(x)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">291</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      level_map[[as.character(col)]] &lt;- list(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">292</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        index = col,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">293</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        levels = levels(x)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">294</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">295</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">296</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">297</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">298</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_alert_info("{if (aggregate) 'aggregating' else 'disaggregating'} {.field {length(source_numeric)}} variable{?s}:")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">299</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    var_groups &lt;- split(colnames(source), !source_numeric)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">300</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    names(var_groups) &lt;- c("TRUE" = "(char)", "FALSE" = "(numb)")[names(var_groups)]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">301</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_bullets(structure(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">302</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vapply(names(var_groups), function(type) paste(type, paste(var_groups[[type]], collapse = ", ")), ""),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">303</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      names = rep("*", length(var_groups))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">304</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">305</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">306</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  method &lt;- as.integer(source_numeric)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">307</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (aggregate) method &lt;- method + 10</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">308</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res &lt;- process_distribute(as.matrix(source), method, tid, w, map, aggregate)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">309</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res &lt;- as.data.frame(res)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">310</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  colnames(res) &lt;- colnames(source)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">311</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!all(source_numeric)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">312</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("re-converting categorical levels")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">313</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (l in level_map) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">314</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      x &lt;- res[, l$index]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">315</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      x[x == 0] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">316</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      res[, l$index] &lt;- l$levels[x]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">317</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">318</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">319</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res &lt;- cbind(id = tid, res)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">320</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (realign) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">321</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("realigning with duplicated target IDs")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">322</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rownames(res) &lt;- tid</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">323</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    res &lt;- res[otid, ]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">324</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rownames(res) &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">325</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">326</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(outFile)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">327</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("writing results to {.file {outFile}}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">328</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dir.create(dirname(outFile), FALSE, TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">329</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!grepl("\\.\\w", outFile)) outFile &lt;- paste0(outFile, ".csv")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">330</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    write.csv(res, outFile, row.names = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">331</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">332</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  invisible(res)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">333</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="src/redistribute.cpp" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">// [[Rcpp::depends(RcppParallel)]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#include &lt;Rcpp.h&gt;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#include &lt;RcppParallel.h&gt;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#include &lt;unordered_map&gt;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">using namespace std;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">using namespace Rcpp;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">using namespace RcppParallel;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">9</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">const int aggregate_mode(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int &amp;os, const RMatrix&lt;double&gt; &amp;source, const int &amp;tstart, const int &amp;tend,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const vector&lt;int&gt; &amp;source_rows</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">13</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  double max = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">14</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  int max_cat = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">15</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  unordered_map&lt;int, double&gt; acc;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">16</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">17</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = source_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">18</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int cat = source[r + os];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">19</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (acc.find(cat) == acc.end()) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">20</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      acc.insert({cat, 1});</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">21</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else acc.at(cat)++;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">22</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int count = acc.at(cat);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">23</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (count &gt; max) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">24</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      max = count;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">25</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      max_cat = cat;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">28</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return max_cat;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">31</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">const double aggregate_sum(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int &amp;os, const RMatrix&lt;double&gt; &amp;source, const int &amp;tstart, const int &amp;tend,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const vector&lt;int&gt; &amp;source_rows, const RVector&lt;double&gt; &amp;w</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">35</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  double sum = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">36</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">37</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = source_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">38</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sum += source[r + os] * w[r];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">40</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return sum;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">43</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">const double aggregate_mean(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int &amp;os, const RMatrix&lt;double&gt; &amp;source, const int &amp;tstart, const int &amp;tend,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const vector&lt;int&gt; &amp;source_rows, const RVector&lt;double&gt; &amp;w, const double &amp;total</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">47</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  double sum = 0;</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">48</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">49</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = source_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">50</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sum += source[r + os] * w[r];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">52</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return sum / total;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">55</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">void proportional_categoric(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int &amp;os, const int &amp;s, const int &amp;tstart, const int &amp;tend, const vector&lt;int&gt; &amp;target_rows,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    RVector&lt;double&gt; &amp;v</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">58</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">59</td>
                    <td class="coverage">36<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">30<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = target_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">61</td>
                    <td class="coverage">30<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    v[r + os] = s;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">64</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">65</td>
                    <td class="coverage">50<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">void proportional_numeric(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int &amp;os, const double &amp;s, const int &amp;tstart, const int &amp;tend, const vector&lt;int&gt; &amp;target_rows,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const RVector&lt;double&gt; &amp;w, const double &amp;total, RVector&lt;double&gt; &amp;v</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">360<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">310<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = target_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">71</td>
                    <td class="coverage">310<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    v[r + os] = s * w[r] / total;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">struct Distribute : public Worker {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  RVector&lt;double&gt; res;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const RMatrix&lt;double&gt; source;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">78</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const vector&lt;int&gt; start, end, index;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const RVector&lt;double&gt; weight;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const vector&lt;double&gt; weight_totals;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const RVector&lt;int&gt; method;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">82</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int ncol = method.length(), n = weight.length(), on = weight_totals.size();</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const bool agg;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">84</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  Distribute(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">85</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    NumericVector &amp;res, const NumericMatrix &amp;source,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">86</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const vector&lt;int&gt; &amp;start, const vector&lt;int&gt; &amp;end, const vector&lt;int&gt; &amp;index,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">87</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const NumericVector &amp;weight, const vector&lt;double&gt; weight_totals, const IntegerVector &amp;method,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">88</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const bool &amp;agg</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">89</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ):</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">90</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    res(res), source(source), start(start), end(end), index(index), weight(weight),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">91</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    weight_totals(weight_totals), method(method), agg(agg)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">92</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  {}</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">93</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  void operator()(size_t s, size_t e){</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    int ck = 1e3, c = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">95</td>
                    <td class="coverage">52<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (; s &lt; e; s++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">96</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const int ss = start[s], se = end[s] + 1;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (ss &gt; -1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">98</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const double total = weight_totals[s];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">99</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (agg) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (c = 0; c &lt; ncol; c++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">101</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            const int os = c * n;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">102</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            switch(method[c]) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 10:</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">104</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                res[s + c * on] = aggregate_mode(os, source, ss, se, index);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">105</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">106</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 11:</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                res[s + c * on] = aggregate_sum(os, source, ss, se, index, weight);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">109</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 12:</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">110</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                res[s + c * on] = aggregate_mean(os, source, ss, se, index, weight, total);</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">111</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">112</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (!--ck) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">114</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              checkUserInterrupt();</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">115</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              ck = 1e3;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">116</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">117</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">118</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">119</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          const RMatrix&lt;double&gt;::Row source_row = source.row(s);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">80<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (c = 0; c &lt; ncol; c++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">121</td>
                    <td class="coverage">56<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            const int os = c * n;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">122</td>
                    <td class="coverage">56<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            switch(method[c]) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">123</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 0:</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                proportional_categoric(os, source_row[c], ss, se, index, res);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">125</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">126</td>
                    <td class="coverage">50<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 1:</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">50<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                if (total) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">128</td>
                    <td class="coverage">50<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                  proportional_numeric(os, source_row[c], ss, se, index, weight, total, res);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">130</td>
                    <td class="coverage">50<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">131</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">56<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (!--ck) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">133</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              checkUserInterrupt();</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">134</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              ck = 1e3;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">135</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">136</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">137</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">138</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">139</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">140</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">141</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">};</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">142</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">143</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">// [[Rcpp::export]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">144</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">NumericVector process_distribute(const NumericMatrix &amp;s, const IntegerVector &amp;method,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">145</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const CharacterVector &amp;tid, const NumericVector &amp;weight, const List &amp;map, const bool &amp;agg) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">146</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int source_n = s.nrow(), nvars = s.ncol(), target_n = tid.length();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">147</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  NumericVector res(nvars * target_n);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">148</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">149</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  // translate map</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">150</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int iter_max = agg ? target_n : source_n;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">151</td>
                    <td class="coverage">44<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  vector&lt;int&gt; start(iter_max), end(iter_max), index;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">152</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  vector&lt;double&gt; weight_totals(iter_max);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">153</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (agg) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">154</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    unordered_map&lt;String, IntegerVector&gt; imap;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">155</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    unordered_map&lt;String, double&gt; wmap;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">156</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (const String &amp;id : tid) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">157</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      IntegerVector indices;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">158</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      imap.insert({id, indices});</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      wmap.insert({id, 0});</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">160</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    int i, t;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">162</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (i = map.length(); i--;) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">163</td>
                    <td class="coverage">20<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const CharacterVector id = map[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">164</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (id.length()) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">165</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        imap.at(id[0]).push_back(i);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        wmap.at(id[0]) += weight[i];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">167</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">168</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">169</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (i = 0; i &lt; target_n; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">170</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const String id = tid[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">171</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      weight_totals[i] = wmap.at(id);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">172</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const IntegerVector indices = imap.at(id);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">173</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const int n = indices.length();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      bool any = false;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">175</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      start[i] = index.size();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">176</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      for (t = 0; t &lt; n; t++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">177</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const int si = indices[t];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">178</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        any = true;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">179</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        index.push_back(si);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">180</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">181</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (any) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">182</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        end[i] = index.size() - 1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">183</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">184</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        start[i] = end[i] = -1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">185</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">186</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">187</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">188</td>
                    <td class="coverage">34<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (int i = 0, t; i &lt; source_n; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">189</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      weight_totals[i] = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">190</td>
                    <td class="coverage">48<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const CharacterVector tids = map[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">191</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (tids.length()) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">192</td>
                    <td class="coverage">48<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const IntegerVector indices = match(tids, tid) - 1;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">193</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const int n = indices.length();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">194</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        bool any = false;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">195</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        start[i] = index.size();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">196</td>
                    <td class="coverage">174<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        for (t = 0; t &lt; n; t++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">197</td>
                    <td class="coverage">150<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          const int si = indices[t];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">150<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (si &gt; -1 &amp;&amp; si &lt; target_n) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">199</td>
                    <td class="coverage">150<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            any = true;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">200</td>
                    <td class="coverage">150<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            index.push_back(si);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">201</td>
                    <td class="coverage">150<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            weight_totals[i] += weight[si];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">202</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">203</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">204</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (any) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">205</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          end[i] = index.size() - 1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">206</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">207</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          start[i] = end[i] = -1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">208</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">209</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">210</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        start[i] = end[i] = -1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">211</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">212</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">213</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">214</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">215</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  // process</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">216</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  Distribute distributed(res, s, start, end, index, weight, weight_totals, method, agg);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">217</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  parallelFor(0, iter_max, distributed);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">218</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">219</td>
                    <td class="coverage">11<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res.attr("dim") = Dimension(target_n, nvars);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">220</td>
                    <td class="coverage">22<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return res;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">221</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <script>$('div#files pre').each(function(i, block) {
    hljs.highlightBlock(block);
});</script>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<style>body{background-color:white;}</style>
<script src="lib/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="lib/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="lib/datatables-binding-0.27/datatables.js"></script>
<script src="lib/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="lib/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="lib/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="lib/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="lib/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="lib/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="lib/highlight.js-6.2/rstudio.css" rel="stylesheet" />
<script src="lib/highlight.js-6.2/highlight.pack.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="lib/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<link href="lib/bootstrap-3.3.5/css/bootstrap-theme.min.css" rel="stylesheet" />
<script src="lib/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="lib/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="lib/bootstrap-3.3.5/shim/respond.min.js"></script>

</head>
<body>
<div class="container-fluid">
  <style type="text/css">table tr:hover td {
  font-weight:bold;text-decoration:none
}
table tr.covered td{
  background-color:rgba(95,151,68,0.3)
}

table tr:hover.covered .num{
  background-color:rgba(95,151,68,0.7)
}
table tr.missed td{
  background-color:rgba(185,73,71,0.3)
}
table tr:hover.missed .num{
  background-color:rgba(185,73,71,0.7)
}

table tr.missed:hover td{
  -webkit-box-shadow:0 -2px 0 0 #b94947 inset;
  -moz-box-shadow:0 -2px 0 0 #b94947 inset;
  box-shadow:0 -2px 0 0 #b94947 inset
}
table tr.covered:hover td{
  -webkit-box-shadow:0 -2px 0 0 #5f9744 inset;
  -moz-box-shadow:0 -2px 0 0 #5f9744 inset;
  box-shadow:0 -2px 0 0 #5f9744 inset
}

table tr.never td{
  background-color:transparent
}

table tbody {
  border-style: solid;
  border: 1px solid rgba(0,0,0,0.1)
}

table .num {
  border-right: 1px solid rgba(0,0,0,0.1)
}

td.coverage em {
  opacity: 0.5;
}

table td.coverage {
  border-right: 1px solid rgba(0,0,0,0.1);
  font-weight: bold;
  text-align: center;
}
table.table-condensed pre {
  background-color: transparent;
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 11px;
}
div#files td {
  padding: 0;
  padding-left: 5px;
}

div#files td.num {
  padding-right: 5px;
}

table.table-condensed {
  font-size: 11px;
}</style>
  <div class="col-md-8 col-md-offset-2">
    <h2>redistribute coverage - 77.39%</h2>
    <div class="tabbable">
      <ul class="nav nav-tabs" data-tabsetid="covr">
        <li class="active">
          <a href="#tab-covr-1" data-toggle="tab" data-value="Files">Files</a>
        </li>
        <li>
          <a href="#tab-covr-2" data-toggle="tab" data-value="Source">Source</a>
        </li>
      </ul>
      <div class="tab-content" data-tabsetid="covr">
        <div class="tab-pane active" title="Files" data-value="Files" id="tab-covr-1">
          <div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8678891efdd664edcfde" style="width:100%;height:500px;"></div>
          <script type="application/json" data-for="htmlwidget-8678891efdd664edcfde">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["<a href=\"#\">R/redistribute.R<\/a>","<a href=\"#\">R/generate_population.R<\/a>","<a href=\"#\">R/download_census_pums.R<\/a>","<a href=\"#\">R/make_parent_polygons.R<\/a>","<a href=\"#\">src/redistribute.cpp<\/a>","<a href=\"#\">src/generate_individuals.cpp<\/a>"],[526,267,211,180,253,195],[342,116,138,121,148,108],[195,79,116,110,145,106],[147,37,22,11,3,2],["7","1","102","11","111","1744128"],["57.02%","68.10%","84.06%","90.91%","97.97%","98.15%"]],"container":"<table class=\"row-border\">\n  <thead>\n    <tr>\n      <th>File<\/th>\n      <th>Lines<\/th>\n      <th>Relevant<\/th>\n      <th>Covered<\/th>\n      <th>Missed<\/th>\n      <th>Hits / Line<\/th>\n      <th>Coverage<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"dom":"t","paging":false,"columnDefs":[{"targets":6,"createdCell":"function(td, cellData, rowData, row, col) {\n  var percent = cellData.replace(\"%\", \"\");\n  if (percent > 90) {\n    var grad = \"linear-gradient(90deg, #edfde7 \" + cellData + \", white \" + cellData + \")\";\n  } else if (percent > 75) {\n    var grad = \"linear-gradient(90deg, #f9ffe5 \" + cellData + \", white \" + cellData + \")\";\n  } else {\n    var grad = \"linear-gradient(90deg, #fcece9 \" + cellData + \", white \" + cellData + \")\";\n  }\n  $(td).css(\"background\", grad);\n}\n"},{"className":"dt-right","targets":[1,2,3,4]}],"order":[],"autoWidth":false,"orderClasses":false},"callback":"function(table) {\ntable.on('click.dt', 'a', function() {\n  files = $('div#files div');\n  files.not('div.hidden').addClass('hidden');\n  id = $(this).text();\n  files.filter('div[id=\\'' + id + '\\']').removeClass('hidden');\n  $('ul.nav a[data-value=Source]').text(id).tab('show');\n});\n}","selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":["options.columnDefs.0.createdCell","callback"],"jsHooks":[]}</script>
        </div>
        <div class="tab-pane" title="Source" data-value="Source" id="tab-covr-2">
          <div id="files">
            <div id="R/make_parent_polygons.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Make Higher-Order Polygons</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Randomly combine given polygons into contiguous, larger polygons.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param polygons An \code{sf} object with polygons to be reformed.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param ids A vector of IDs the same length as \code{polygons}, or the column name</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' in \code{polygons} to use as IDs.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param n Number of polygons to aim to combine for each new polygon.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param strict_n Logical; if \code{TRUE} (default), \code{n} represents the number of</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' intersecting polygons to select, depending on availability (with a minimum of 2).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' If \code{FALSE}, \code{n} represents the number of nearest polygons (by centroid)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' to use when calculating a box to use when selecting polygons (with a minimum of 1).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param n_as_min Logical; if \code{TRUE}, will merge any parents with fewer than \code{n}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' children with a random neighbor. Otherwise (and by default), parents may have fewer than \code{n}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' children. Applies if \code{strict_n} is \code{TRUE}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param buffer_dist Distance around each initial shape or set of shapes, used to define</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' neighboring shapes. Applies if \code{strict_n} is \code{TRUE}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param min_overlap Minimal area of overlap between potential neighboring shapes and</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the buffered target shape, used to define neighboring shapes.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Applies if \code{strict_n} is \code{TRUE}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param verbose Logical; if \code{FALSE}, will not print status messages.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @returns A list with entries for \code{new} (an \code{sf} object containing the new polygons)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' and \code{map} (a list mapping between the old and new polygon indices).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">make_parent_polygons &lt;- function(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    polygons, ids = NULL, n = 2, strict_n = TRUE, n_as_min = FALSE, buffer_dist = 5e-5,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    min_overlap = NULL, verbose = TRUE) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">29</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!inherits(polygons, "sf")) cli_abort("{.arg polygons} must be an sf object")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">30</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(ids) == 1 &amp;&amp; ids %in% colnames(polygons)) ids &lt;- polygons[[ids]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">31</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  polygons &lt;- st_geometry(polygons)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">32</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  polygons &lt;- st_cast(st_boundary(polygons), "POLYGON", do_split = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">33</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (strict_n &amp;&amp; is.null(NULL)) min_overlap &lt;- min(s2_area(polygons)) * .0035</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">34</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  n_poly &lt;- length(polygons)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">35</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(ids)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">36</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(ids) != n_poly) cli_abort("{.arg ids} do not align with {.arg polygons}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">37</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    names(polygons) &lt;- ids</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">39</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  n &lt;- max(if (strict_n) 2 else 1, min(n, n_poly - 1))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">40</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sels &lt;- seq_len(n) + 1L</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">41</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  centers &lt;- st_coordinates(suppressWarnings(st_centroid(polygons)))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">42</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  rownames(centers) &lt;- seq_len(nrow(centers))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">43</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  map &lt;- new &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">44</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  accounted &lt;- integer(n_poly)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">45</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">46</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_progress_step(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">47</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "mapping child polygons ({.field {sum(accounted)}}/{.field {n_poly}})",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">48</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      msg_done = paste0(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">49</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "created initial map from {.field {length(map)}} parent polygons to ",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">50</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "{.field {n_poly}} child polygons"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">52</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      spinner = TRUE</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">55</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (i in seq_len(n_poly)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">56</td>
                    <td class="coverage">50<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_progress_update()</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">57</td>
                    <td class="coverage">50<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    available &lt;- which(accounted == 0L)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">58</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!length(available)) break</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">59</td>
                    <td class="coverage">47<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    start &lt;- if (length(available) == 1) available else sample(available, 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">47<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (strict_n) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">61</td>
                    <td class="coverage">35<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sg &lt;- st_buffer(polygons[[start]], buffer_dist, 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">62</td>
                    <td class="coverage">35<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ag &lt;- polygons[available]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">63</td>
                    <td class="coverage">35<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      pre &lt;- st_intersects(sg, ag)[[1]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">64</td>
                    <td class="coverage">35<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (length(pre)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">65</td>
                    <td class="coverage">35<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        pre &lt;- pre[vapply(ag[pre], function(t) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">66</td>
                    <td class="coverage">149<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          s2_area(st_intersection(t, sg, model = "closed"))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">67</td>
                    <td class="coverage">35<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }, 0) &gt; min_overlap]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">35<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      set &lt;- unique(c(start, available[pre]))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">35<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sn &lt;- length(set)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">71</td>
                    <td class="coverage">35<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (sn &lt; n) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">72</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        available &lt;- available[!available %in% set]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">73</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        while (length(set) &lt; n &amp;&amp; length(available)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">74</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          sg &lt;- st_buffer(st_boundary(polygons[set])[[1]], buffer_dist, 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">75</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          ag &lt;- polygons[available]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">76</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          pre &lt;- st_intersects(sg, ag)[[1]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">77</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (length(pre)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">78</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            pre &lt;- pre[vapply(ag[pre], function(t) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">79</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              s2_area(st_intersection(t, sg, model = "closed"))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">80</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }, 0) &gt; min_overlap]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          set &lt;- unique(c(set, available[pre]))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">83</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (length(set) &gt; n) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">84</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            set &lt;- set[seq_len(n)]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">85</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            break</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">86</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            su &lt;- !available %in% set</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">88</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (all(su)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">89</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              break</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">90</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">91</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              available &lt;- available[su]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">92</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">93</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">94</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">96</td>
                    <td class="coverage">26<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        set &lt;- set[seq_len(n)]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">97</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">98</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">99</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      nearest &lt;- as.integer(names(sort(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        lma_simets(centers, centers[start, ], metric = "euclidean"), TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">101</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      )[sels]))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">102</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      adj &lt;- max(abs(centers[nearest, ] - rep(unname(centers[start, ]), each = n)))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      set &lt;- unique(c(start, available[st_intersects(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">104</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        st_polygon(list(matrix(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">105</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          rep(centers[start, ], each = 5) - adj * c(1, -1, -1, 1, 1, 1, 1, -1, -1, 1), 5</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">106</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ))), polygons[available]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      )[[1]]]))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">108</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">109</td>
                    <td class="coverage">47<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    accounted[set] &lt;- 1L</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">110</td>
                    <td class="coverage">47<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    map &lt;- c(list(set), map)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">111</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">112</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  map &lt;- data.frame(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    super = rep(seq_along(map), vapply(map, length, 0)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">114</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sub = unlist(map, use.names = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">115</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  )</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">116</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  map &lt;- map[!duplicated(map$sub), ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  map &lt;- split(map$sub, map$super)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">118</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (n_as_min) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">119</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    su &lt;- which(vapply(map, length, 0) &lt; n)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(su)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">121</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      i &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">122</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      defunct &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">123</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_progress_step(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">125</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          "merging in {.field {length(defunct)}}/{.field {length(su)}} parent{?/s} with too few children",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">126</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          msg_done = "merged in {.field {length(defunct)}} of {.field {length(su)}} small parent{?/s}",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          spinner = TRUE</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">128</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">130</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      tmap &lt;- data.frame(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">131</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        super = rep(seq_along(map), vapply(map, length, 0)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        sub = unlist(map, use.names = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">133</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      )</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">134</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      available &lt;- seq_along(polygons)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">135</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      for (i in su) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">136</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        available &lt;- available[!available %in% map[[i]]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        sg &lt;- st_buffer(st_boundary(polygons[map[[i]]])[[1]], buffer_dist, 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ag &lt;- polygons[available]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">139</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        pre &lt;- st_intersects(sg, ag)[[1]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (length(pre)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">141</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          pre &lt;- pre[vapply(ag[pre], function(t) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">142</td>
                    <td class="coverage">13<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            s2_area(st_intersection(t, sg, model = "closed"))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">143</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }, 0) &gt; min_overlap]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">144</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">145</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (length(pre)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">146</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          ns &lt;- available[if (length(pre) == 1) pre else sample(pre, 1)]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">147</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          np &lt;- tmap[[1]][tmap[[2]] == ns]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">148</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          map[[np]] &lt;- c(map[[np]], map[[i]])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">149</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          available &lt;- available[!available %in% map[[np]]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">150</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          defunct &lt;- c(defunct, i)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">151</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">152</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_progress_update()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">153</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">154</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (length(defunct)) map &lt;- map[-defunct]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">155</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_progress_done()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">156</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">157</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    map &lt;- data.frame(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">158</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      super = rep(seq_along(map), vapply(map, length, 0)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sub = unlist(map, use.names = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">160</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">161</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    map &lt;- map[!duplicated(map$sub), ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">162</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    map &lt;- split(map$sub, map$super)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">163</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">164</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(ids)) map &lt;- lapply(map, function(l) ids[l])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">165</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  i &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">167</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_progress_step(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">168</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "creating new polygons ({.field {i}}/{.field {length(map)}})",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">169</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      msg_done = "created {.field {length(map)}} new polygons", spinner = TRUE</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">170</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">171</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">172</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  new &lt;- do.call(c, lapply(map, function(l) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">173</td>
                    <td class="coverage">43<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">43<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      i &lt;&lt;- i + 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">175</td>
                    <td class="coverage">43<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_progress_update(.envir = parent.frame(2))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">176</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">177</td>
                    <td class="coverage">43<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    st_union(polygons[l])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">178</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">179</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  list(new = new, map = map)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">180</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/download_census_pums.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Download U.S. Census Microdata</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Download and load U.S. census American Community Survey (ACS) Public Use Microdata Samples (PUMS):</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (census.gov/programs-surveys/acs/microdata.html)[https://www.census.gov/programs-surveys/acs/microdata.html]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param dir Directory in which to save the file(s).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param state Postal or FIPS code of the state.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param year 4 digit year, between 2005 and the most recent year.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param level A character indicating whether to get the person- or household-level sample. Defaults to both.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param one_year Logical; if \code{FALSE}, will get the 5-year estimates rather than the 1-year file. If</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' not specified, will fall back to the 5-year file if the 1-year file is not available.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param calculate_error Logical; if \code{TRUE}, will calculate standard errors for each variable using</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the Successive Difference Replicate Formula from the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' [PUMS handbook](https://www.census.gov/programs-surveys/acs/library/handbooks/pums.html).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param crosswalk Logical; if \code{FALSE}, will not retrieve the PUMA relationship files for associating</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Census tracts with PUM areas. This will be treated as \code{TRUE} if</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{geoids} is specified.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param geoids A vector of county, tract, or block group GEOIDs within the specified state to</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' select PUM areas by; defaults to all areas. If specified, \code{crosswalk} will be treated as \code{TRUE}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param verbose Logical; if \code{FALSE}, will not print status messages.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \dontrun{</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' download_census_pums(".", "va")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @return A list with entries for \code{year} and \code{state} (as specified),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{dictionary} (containing the data dictionary for that year), \code{household} and/or \code{person}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (with survey data), and optionally \code{household_error} and/or \code{person_error}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (if \code{calculate_error} is \code{TRUE}), and \code{crosswalk} (if \code{crosswalk} is \code{TRUE} or</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{geoids} is specified).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">download_census_pums &lt;- function(dir, state, year = 2021, level = "both", one_year = TRUE, calculate_error = FALSE,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                 crosswalk = TRUE, geoids = NULL, verbose = TRUE) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">35</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  us_fips &lt;- list(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">36</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    post = c(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">37</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "us", "al", "ak", "az", "ar", "ca", "co", "ct", "de", "dc", "fl", "ga", "hi", "id", "il", "in", "ia", "ks", "ky",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">38</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "la", "me", "md", "ma", "mi", "mn", "ms", "mo", "mt", "ne", "nv", "nh", "nj", "nm", "ny", "nc", "nd", "oh", "ok",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">39</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "or", "pa", "ri", "sc", "sd", "tn", "tx", "ut", "vt", "va", "wa", "wv", "wi", "wy", "pr"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">41</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    fips = c(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">42</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "us", 1, 2, 4, 5, 6, 8, 9, 10, 11, 12, 13, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">43</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 44, 45, 46, 47, 48, 49, 50, 51, 53, 54, 55, 56, 72</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  )</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">46</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  state &lt;- gsub("^0|[^a-z0-9]", "", tolower(state[[1]]))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">47</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  fid &lt;- which(us_fips$fips == state)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">48</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!length(fid) &amp;&amp; nchar(state) == 2) fid &lt;- which(us_fips$post == state)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">49</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!length(fid) || is.na(fid)) cli_abort("failed to recognize {.arg state}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">50</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  state &lt;- us_fips$post[fid]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">51</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  level &lt;- tolower(substring(level, 1, 1))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">52</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!level %in% c("h", "p", "b")) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">53</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_abort(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">54</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      '{.arg level} should be one of {.field "houshold"}, {.field "person"}, or {.field "both"}.'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">57</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  summary &lt;- if (one_year) "1-Year" else "5-Year"</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">58</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  urls &lt;- paste0(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">59</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    "https://www2.census.gov/programs-surveys/acs/data/pums/", year,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    "/", summary, "/csv_", c("h", "p"), state, ".zip"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  )</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">62</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(dir)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">63</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dir &lt;- tdir &lt;- paste0(normalizePath(dir, "/", FALSE), "/")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">64</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!dir.exists(dir)) dir.create(dir, FALSE, TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">66</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tdir &lt;- paste0(tempdir(), "/")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">68</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  folder &lt;- paste0(tdir, "pums_", state, "/", year, "/")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  dir.create(folder, FALSE, TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res &lt;- list(year = year, state = state, dictionary = NULL, household = NULL, person = NULL)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">71</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  dict_json &lt;- paste0(folder, paste0("PUMS_Data_Dictionary_", year, ".json"))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">72</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (file.exists(dict_json)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">73</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    res$dictionary &lt;- read_json(dict_json, simplifyVector = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">75</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dict_file &lt;- sub(".json", ".csv", dict_json, fixed = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">76</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!file.exists(dict_file)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">77</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      url &lt;- paste0("https://www2.census.gov/programs-surveys/acs/tech_docs/pums/data_dict/", basename(dict_file))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">78</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      status &lt;- curl_fetch_disk(url, dict_file)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">79</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (status$status_code != 200) cli_abort("failed to retrieve data dictionary from {.url {url}}")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">81</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dict &lt;- readLines(dict_file, warn = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    res$dictionary &lt;- lapply(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">83</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      split(dict, sub(",.*$", "", sub("^[^,]+,", "", dict, perl = TRUE), perl = TRUE)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">84</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      function(e) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">85</td>
                    <td class="coverage">521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        h &lt;- suppressWarnings(scan(text = e[[1]], what = "", sep = ",", quiet = TRUE))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        map &lt;- as.data.frame(do.call(rbind, lapply(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          e[-1], function(l) suppressWarnings(scan(text = l, what = "", sep = ",", quiet = TRUE))[5:7]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">88</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        )))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">89</td>
                    <td class="coverage">521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        colnames(map) &lt;- c("from", "to", "value")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">90</td>
                    <td class="coverage">521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        list(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">91</td>
                    <td class="coverage">521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          description = h[5],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">92</td>
                    <td class="coverage">521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          type = if (h[3] == "C") "character" else "integer",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">93</td>
                    <td class="coverage">521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          length = as.numeric(h[4]),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">521<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          map = map</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">96</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">97</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">98</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    write_json(res$dictionary, dict_json, auto_unbox = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">99</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  files &lt;- paste0(folder, "/", c("h", "p"), summary, ".csv.xz")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">101</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (level != "b") {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">102</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    lid &lt;- (level == "p") + 1</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">103</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    urls &lt;- urls[lid]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">104</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    files &lt;- files[lid]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">105</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">106</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  can_change &lt;- missing(one_year)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (i in seq_along(urls)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    url &lt;- urls[i]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">109</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    clevel &lt;- if (grepl("csv_h", url, fixed = TRUE)) "household" else "person"</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">110</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!file.exists(files[i])) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">111</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      file_zip &lt;- paste0(folder, basename(url))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">112</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (!file.exists(file_zip)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("retrieving {clevel} sample: {.url {url}}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">114</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        status &lt;- curl_fetch_disk(url, file_zip)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">115</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (status$status_code != 200 &amp;&amp; can_change) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">116</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          new_summary &lt;- if (one_year) "5-Year" else "1-Year"</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">117</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          urls &lt;- sub(summary, new_summary, urls, fixed = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">118</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          files &lt;- sub(summary, new_summary, files, fixed = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">119</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          summary &lt;- new_summary</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">120</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          url &lt;- urls[i]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">121</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          status &lt;- curl_fetch_disk(url, file_zip)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">122</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">123</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        can_change &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (status$status_code != 200) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">125</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          unlink(file_zip)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">126</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          cli_abort(paste0(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">127</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            "failed to download {.url {url}}: ", strsplit(rawToChar(status$headers), "[\r\n]")[[1]][1]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">128</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">131</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      rfile &lt;- paste0(folder, grep(".csv", unzip(file_zip, list = TRUE)$Name, fixed = TRUE, value = TRUE))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      unzip(file_zip, exdir = folder)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">133</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cols &lt;- strsplit(readLines(rfile, 1), ",")[[1]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">134</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      types &lt;- paste(vapply(cols, function(n) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">135</td>
                    <td class="coverage">528<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        type &lt;- res$dictionary[[n]]$type</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">136</td>
                    <td class="coverage">528<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (is.null(type)) if (grepl("WGTP", n, fixed = TRUE)) "i" else "c" else substring(type, 1, 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }, ""), collapse = "")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      res[[clevel]] &lt;- vroom(rfile, col_types = types)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">139</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vroom_write(res[[clevel]], files[i], ",")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      on.exit(unlink(rfile), add = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">141</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">142</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("loading {clevel} sample: {.field {basename(files[i])}}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">143</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cols &lt;- strsplit(readLines(files[i], 1), ",")[[1]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">144</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      types &lt;- paste(vapply(cols, function(n) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">145</td>
                    <td class="coverage">528<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        type &lt;- res$dictionary[[n]]$type</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">146</td>
                    <td class="coverage">528<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (is.null(type)) if (grepl("WGTP", n, fixed = TRUE)) "i" else "c" else substring(type, 1, 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">147</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }, ""), collapse = "")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">148</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      res[[clevel]] &lt;- vroom(files[i], col_types = types)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">149</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">150</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    weight &lt;- if (clevel == "person") "PWGTP" else "WGTP"</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">151</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (calculate_error &amp;&amp; paste0(weight, "1") %in% cols) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">152</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("calculating {clevel} errors")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">153</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vars &lt;- cols[!grepl("^(?:RT|SERIAL|DIV|PUMA|REG|ST|ADJ)|WGTP", cols) &amp; cols %in% names(res$dictionary)]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">154</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      names(vars) &lt;- vars</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">155</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      wv &lt;- res[[clevel]][, weight, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">156</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      w &lt;- as.matrix(res[[clevel]][, grep("WGTP\\d+", cols)])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">157</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      res[[paste0(clevel, "_error")]] &lt;- as.data.frame(do.call(cbind, lapply(vars, function(name) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">158</td>
                    <td class="coverage">350<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        v &lt;- res[[clevel]][, name, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">350<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        map &lt;- res$dictionary[[name]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">160</td>
                    <td class="coverage">350<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (map$type == "integer") {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">161</td>
                    <td class="coverage">45<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          sqrt(.05 * rowSums((w - v * wv)^2))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">162</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">163</td>
                    <td class="coverage">305<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          levels &lt;- map$map$from</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">164</td>
                    <td class="coverage">305<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          names(levels) &lt;- paste0(name, "_", levels)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">165</td>
                    <td class="coverage">305<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          vapply(levels, function(l) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">4787<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            sqrt(.05 * rowSums((w - (v == l) * wv)^2))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">167</td>
                    <td class="coverage">305<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }, numeric(length(v)))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">168</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">169</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      })))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">170</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">171</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">172</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (crosswalk || !is.null(geoids)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">173</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    decade &lt;- paste0(substring(year, 1, 3), "0")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    url &lt;- if (decade == "2020") {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">175</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "https://www2.census.gov/geo/docs/maps-data/data/rel2020/2020_Census_Tract_to_2020_PUMA.txt"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">176</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">177</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "https://www2.census.gov/geo/docs/maps-data/data/rel/2010_Census_Tract_to_2010_PUMA.txt"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">178</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">179</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    crosswalk_file &lt;- paste0(folder, basename(url))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">180</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!file.exists(crosswalk_file)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">181</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("retrieving crosswalk {.url {url}}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">182</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      status &lt;- curl_fetch_disk(url, crosswalk_file)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">183</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (status$status_code != 200) cli_warn("failed to retrieve crosswalk from {.url {url}}")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">184</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">185</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (file.exists(crosswalk_file)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">186</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("loading crosswalk {.field {basename(crosswalk_file)}}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">187</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      res$crosswalk &lt;- vroom(crosswalk_file, col_types = "cccc")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">188</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (!is.null(geoids)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">189</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        geoids &lt;- substring(geoids, 1, 11)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">190</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        su &lt;- do.call(paste0, res$crosswalk[, 1:2]) %in% geoids | do.call(paste0, res$crosswalk[, 1:3]) %in% geoids</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">191</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (any(su)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">192</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          pids &lt;- unique(res$crosswalk$PUMA5CE[su])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">193</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">194</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            cli_alert_info(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">195</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              "subsetting to {length(pids)} of {length(unique(res$crosswalk$PUMA5CE))} PUM areas"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">196</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">197</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (set in c("household", "person")) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">199</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            su &lt;- formatC(as.numeric(res[[set]]$PUMA), width = 5, flag = 0) %in% pids</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">200</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            res[[set]] &lt;- res[[set]][su, ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">201</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            set_error &lt;- paste0(set, "_error")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">202</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (set_error %in% names(res)) res[[set_error]] &lt;- res[[set_error]][su, ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">203</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">204</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">205</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          cli_warn("none of the specified {.arg geoids} were found in the crosswalk")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">206</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">207</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">208</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">209</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">210</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">211</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/generate_population.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Generate a Population</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Simulate a population of individuals within households, with complex relationships between</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' demographic and location features.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' The population is generated in two steps:</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \strong{First}, households are generated and placed within \code{regions}. Placement within regions</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' is determined by total distance from one or more regions selected as attraction loci. If</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' coordinates are not provided, these are first randomly generated.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' After households are placed, household sizes and incomes (of the first member) are generated</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' with their own independent spacial loci. Renting status is then generated based on income:</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' 60\% chance if income is under the mean income, and 40\% otherwise.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \strong{Second}, individuals are generated for each household. To generate an individual,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' first, neighbors are searched for, based on \code{n_neighbors} and \code{neighbor_range}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Any neighbors are summarized: average age and income, and tabulated race.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' These then affect the first member of the household: age is first drawn from a Beta</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' distribution (with shapes of \code{1} and \code{2} if renting or \code{1.5} otherwise,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' multiplied by \code{80}) and added to \code{18}, then adjusted toward a random value centered</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' on the average neighbor age (floored Gaussian with a standard deviation of \code{1}), and race</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' is sampled (that with the highest result of a Binomial draw with \code{n_races} trials</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' proportion of \code{neighbors * base rate} chance of success for each race group).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Neighbors also affect the income of the second member of the household if the first</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' member's income is under the neighbor mean income (or under \code{40,000} given no neighbors);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' in this case, the second member's income is drawn from a Gaussian distribution centered on</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the first member's income, with a standard deviation of \code{10,000}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' The second member's age is based on that of the first member; a floored Gaussian centered on</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the first member's age, with a standard deviation of \code{15} if the first member's age</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' if over \code{40}, or \code{5} otherwise, trimmed to be between \code{18} and \code{90}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">35</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' The second member's race has a 70\% chance to be that of the first member,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' and a 30\% chance to be selected like the first member's.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Members after the second have no income, have age randomly selected from a</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' uniform distribution between \code{0} and the first member's age minus \code{15}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (which is then rounded up), and have race determined by either the first or second</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' member (50\% chance).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Sex has a 50\% chance to be \code{0} or \code{1} for all but the second member; their sex</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' has a 10\% chance to be the same as the first member's, and 90\% chance to be opposite.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param N Number of initial individuals to generate. Final number of individuals will be larger.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param regions A vector of region IDs, a matrix of coordinates, or an \code{sf} object with</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">49</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' geometries from which coordinates can be derived. If not specified</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (and \code{capacities} is not specified), regions similar to housing units (with a mix of</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' single and multi-family locations) will be generated.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">52</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param capacities A vector with the maximum number of households for each entry in \code{regions}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param attraction_loci Number of locations selected to be centers of attractiveness,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' which influence where households are located.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param random_regions A number between \code{0} and \code{1}, which determines the proportion of</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' people who are randomly relocated, in the case that there is more capacity than households.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param cost_loci Number of locations selected to be centers of cost, which influences</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">58</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the initial income associated with households.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param size_loci Number of locations selected to be centers of size, which influence</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">60</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' household sizes.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param similarity_metric Name of a metric to use to calculate nearness between</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' neighbors; see \code{\link[lingmatch]{lma_simets}}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param n_neighbors Number of neighbors used to influence each new household's</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">64</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' initial age and race.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param neighbor_range Minimum similarity between people to be considered</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' neighbors, between \code{0} and \code{1} (where \code{0} means unrestricted,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' and \code{1} means same region only).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param n_races Number of different race groups to sample from.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">69</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param verbose Logical; if \code{TRUE}, will show status messages.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">70</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">71</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' generate_population(2)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @returns A list with entries for \code{params} (with initial settings), and two</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{data.frames}:</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \describe{</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   \item{\code{households}}{</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'     \tabular{ll}{</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{household} \tab Household ID. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">78</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{region} \tab Region ID. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{head_income} \tab Income of the first household member. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{size} \tab Number of individuals in the household. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{renting} \tab Binary indicator of renting status. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">82</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'     }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   \item{\code{individuals}}{</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">85</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'     \tabular{ll}{</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">86</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{household} \tab Household ID. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">87</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{person} \tab Person ID. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">88</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{neighbors} \tab Number of neighbors who bore on variables. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">89</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{age} \tab Age in years. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">90</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{sex} \tab Categorical indicator of sex. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">91</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{race} \tab Categorical indicator of race. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">92</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'       \code{income} \tab Income of individual. \cr</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">93</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'     }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">94</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">96</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">97</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">98</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">generate_population &lt;- function(N = 1000, regions = NULL, capacities = NULL, attraction_loci = 2,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">99</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                random_regions = .1, cost_loci = 2, size_loci = 2,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">100</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                similarity_metric = "euclidean", n_neighbors = 50,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">101</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                                neighbor_range = .5, n_races = 6, verbose = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">102</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (inherits(regions, "sf")) regions &lt;- st_coordinates(st_centroid(regions))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  gen_regions &lt;- missing(regions)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">104</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  gen_capacities &lt;- missing(capacities)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">105</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (gen_regions) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">106</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (gen_capacities) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("regions: sequence along {.arg N}, with housing unit capacities")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      regions &lt;- seq_len(N)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">109</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      capacities &lt;- rep(1, N)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">110</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      n_multi &lt;- round(N * .1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">111</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      capacities[sample.int(N, n_multi)] &lt;- sample(5:300, n_multi, TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">112</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">113</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">114</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_alert_info(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">115</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          "regions: sequence along specified {.arg capacities} with specified capacities"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">116</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">117</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">118</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      regions &lt;- seq_along(capacities)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">119</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">120</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">121</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(dim(regions)) == 2) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">122</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(capacities) == 1 &amp;&amp; is.character(capacities) &amp;&amp; capacities %in% colnames(regions)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">123</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">124</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_alert_info(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">125</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          "regions: specified coordinates, with capacities from {.field {capacities}} column"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">126</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">127</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">128</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      capacities &lt;- regions[, capacities, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">129</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      regions &lt;- regions[, colnames(regions) != capacities]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">130</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">131</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_alert_info(paste(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">132</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "regions: specified coordinates, with",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">133</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (gen_capacities) "{.field N / nrow(regions)}" else "specified", "capacities"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">134</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">135</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">136</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rids &lt;- if (is.null(rownames(regions))) seq_len(nrow(regions)) else rownames(regions)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">137</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rids &lt;- if (length(regions) == 1 &amp;&amp; is.numeric(regions)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">139</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">140</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_alert_info(paste(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">141</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          "regions: sequence of {.field N}, with",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">142</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (gen_capacities) "{.field N / nrow(regions)}" else "specified", "capacities"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">143</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">144</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">145</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      as.character(seq_len(regions))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">146</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">147</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose &amp;&amp; !gen_regions) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">148</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_alert_info(paste(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">149</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          "regions:", if (gen_capacities) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">150</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            "specified region, with {.field N / nrow(regions)}"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">151</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">152</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            "specified regions and"</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">153</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }, "capacities"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">154</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">155</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">156</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      regions</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">157</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">158</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    regions &lt;- matrix(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ceiling(rnorm(length(rids) * 2, 1e5, 1e4)),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">160</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ncol = 2, dimnames = list(rids, c("X", "Y"))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">162</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">163</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  nr &lt;- length(rids)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">164</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  capacities &lt;- rep_len(if (!is.numeric(capacities)) N / nr else capacities, nr)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">165</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) cli_alert_info("preparing {.field {N}} households")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">167</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  household &lt;- seq_len(N)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">168</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">169</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # select attraction loci</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">170</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.numeric(attraction_loci) || attraction_loci &lt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">171</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    attraction_loci &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">172</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_warning("setting {.arg attraction_loci} to {.field 1}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">173</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (attraction_loci &gt; nr) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    attraction_loci &lt;- max(1, nr - 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">175</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">176</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_alert_warning(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">177</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "too many attraction loci; setting {.arg attraction_loci} to {.field {attraction_loci}}"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">178</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">179</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">180</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">181</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_alert_info("attraction loci: {.field {attraction_loci}}")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">182</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">183</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  selected_attraction_loci &lt;- sample.int(nr, attraction_loci)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">184</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) cli_alert_info("calculating region similarities")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">185</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (nr == 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">186</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    space &lt;- Matrix(1, dimnames = list(rids, rids), sparse = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">187</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">188</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    space &lt;- lma_simets(regions, metric = similarity_metric, symmetrical = TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">189</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">190</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) cli_alert_info("rescaling region similarities")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">191</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  min_space &lt;- min(space@x)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">192</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  space@x &lt;- (space@x - min_space) / (max(space@x) - min_space)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">193</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  space_cols &lt;- integer(ncol(space))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">194</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">195</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # select initial locations</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">196</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  space_cols[selected_attraction_loci] &lt;- -1L</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">197</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ro &lt;- order(space %*% space_cols)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  space_cols[selected_attraction_loci] &lt;- 0L</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">199</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  rids_expanded &lt;- rep(ro, capacities[ro])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">200</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  region &lt;- rids_expanded[household]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">201</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">202</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (N &lt; length(rids_expanded) &amp;&amp; is.numeric(random_regions)) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">203</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    # redistribute a portion</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">204</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    moves &lt;- min(length(rids_expanded) - N, N * random_regions)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">205</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (moves &gt; 0) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">206</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("randomly placing {.field {moves}} households in remaining regions")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">207</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      region[sample(household, moves)] &lt;- sample(rids_expanded[-household], moves)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">208</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">209</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">210</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">211</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # select head-of-household income</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">212</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.numeric(cost_loci) || cost_loci &lt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">213</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cost_loci &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">214</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_warning("setting {.arg cost_loci} to {.field 1}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">215</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (cost_loci &gt; nr) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">216</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cost_loci &lt;- max(1, nr - 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">217</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_warning("too many cost loci; setting {.arg cost_loci} to {.field {cost_loci}}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">218</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">219</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_alert_info("cost loci: {.field {cost_loci}}")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">220</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">221</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  selected_cost_loci &lt;- sample.int(nr, cost_loci)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">222</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  space_cols[selected_cost_loci] &lt;- 1L</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">223</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  region_cost &lt;- rnorm(nr, (as.numeric(space %*% space_cols) / nr) * 3e5, 3e4)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">224</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  space_cols[selected_cost_loci] &lt;- 0L</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">225</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  head_income &lt;- abs(as.integer(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">226</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rnorm(N, region_cost[region], 2e3) + (rbeta(N, .1, 1) - .6) * region_cost[region]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">227</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">228</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">229</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # select household sizes</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">230</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.numeric(size_loci) || size_loci &lt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">231</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    size_loci &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">232</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_warning("setting {.arg size_loci} to {.field 1}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">233</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (size_loci &gt; nr) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">234</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    size_loci &lt;- max(1, nr - 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">235</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_warning("too many size loci; setting {.arg size_loci} to {.field {size_loci}}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">236</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">237</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_alert_info("size loci: {.field {size_loci}}")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">238</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">239</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  selected_size_loci &lt;- sample.int(nr, size_loci)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">240</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  space_cols[selected_size_loci] &lt;- 1L</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">241</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  size_prob &lt;- ((space %*% space_cols) / nr)[region, ] +</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">242</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rbeta(N, head_income / max(head_income), 1)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">243</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  size &lt;- rpois(N, 1 + size_prob * (max(size_prob) - size_prob) / 1) + 1L</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">244</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">245</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # selecting renting status</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">246</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) cli_alert_info("drawing renting status")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">247</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  renting &lt;- rbinom(N, 1, (head_income &lt; mean(head_income)) * .4 + .2)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">248</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">249</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # select race base rates</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">250</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) cli_alert_info("drawing race baserates")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">251</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  race_rates &lt;- rbeta(n_races, 1, 5)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">252</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  race_rates &lt;- race_rates / (race_rates + max(race_rates))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">253</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">254</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  # preparing individual data</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">255</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) cli_alert_info("generating individuals")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">256</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  space@x[space@x &lt; neighbor_range] &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">257</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  space &lt;- drop0(space)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">258</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  individuals &lt;- generate_individuals(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">259</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    region, head_income, size, renting, space, n_neighbors, race_rates</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">260</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">261</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">262</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  list(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">263</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    params = list(neighbors = n_neighbors, range = neighbor_range, races_rates = race_rates),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">264</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    households = data.frame(household, region = rids[region], head_income, size, renting),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">265</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    individuals = as.data.frame(individuals)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">266</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">267</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="R/redistribute.R" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Redistribute Data</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Distribute data from a source frame to a target frame.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param source A matrix-like object you want to distribute from; usually this will be</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the real or more complete dataset, and is often at a lower resolution / higher level.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param target A matrix-like object you want to distribute to: usually this will be</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' the dataset you want but isn't available, and is often at a higher resolution / lower level</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">9</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (for disaggregation). Can also be a single number, representing the number of initial</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' characters of \code{source} IDs to derive target IDs from (useful for aggregating up nested groups).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param map A list with entries named with \code{source} IDs (or aligning with those IDs),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' containing vectors of associated \code{target} IDs (or indices of those IDs). Entries</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">13</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' can also be numeric vectors with IDs as names, which will be used to weigh the relationship.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">14</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' If IDs are related by substrings (the first characters of \code{target} IDs are \code{source} IDs),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">15</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' then a map can be automatically generated from them. If \code{source} and \code{target}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">16</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' contain \code{sf} geometries, a map will be made with \code{\link[sf]{st_intersects}}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (\code{st_intersects(source, target)}). If an intersects map is made, and \code{source}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' is being aggregated to \code{target}, and map entries contain multiple target IDs,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">19</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' those entries will be weighted by their proportion of overlap with the source area.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param source_id,target_id Name of a column in \code{source} / \code{target},</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' or a vector containing IDs. For \code{source}, this will default to the first column. For</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{target}, columns will be searched through for one that appears to relate to the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source IDs, falling back to the first column.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param weight Name of a column, or a vector containing weights (or single value to apply to all cases),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' which apply to \code{target} when disaggregating, and \code{source} when aggregating.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Defaults to unit weights (all weights are 1).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param source_variable,source_value If \code{source} is tall (with variables spread across</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">28</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' rows rather than columns), specifies names of columns in \code{source} containing variable names</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' and values for conversion.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param aggregate Logical; if specified, will determine whether to aggregate or disaggregate</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' from \code{source} to \code{target}. Otherwise, this will be \code{TRUE} if there are more</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{source} observations than \code{target} observations.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param weight_agg_method Means of aggregating \code{weight}, in the case that target IDs contain duplicates.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Options are \code{"sum"}, \code{"average"}, or \code{"auto"} (default; which will sum if \code{weight}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">35</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' is integer-like, and average otherwise).</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param default_value Value to set to any unmapped target ID.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param outFile Path to a CSV file in which to save results.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param overwrite Logical; if \code{TRUE}, will overwrite an existing \code{outFile}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">39</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param make_intersect_map Logical; if \code{TRUE}, will opt to calculate an intersect-based map</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">40</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' rather than an ID-based map, if both seem possible. If specified as \code{FALSE}, will</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">41</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' never calculate an intersect-based map.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">42</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param overlaps If specified and not \code{TRUE} or \code{"keep"}, will assign \code{target}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">43</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' entities that are mapped to multiple \code{source} entities to a single source entity. The value</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">44</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' determines how entities with the same weight should be assigned, between \code{"first"} (default),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">45</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{"last"}, and \code{"random"}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">46</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param use_all Logical; if \code{TRUE} (default), will redistribute map weights so they sum to 1.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' Otherwise, entities may be partially weighted.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param return_geometry Logical; if \code{FALSE}, will not set the returned \code{data.frame}'s</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">49</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' geometry to that of \code{target}, if it exists.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param return_map Logical; if \code{TRUE}, will only return the map, without performing the</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' redistribution. Useful if you want to inspect an automatically created map, or use it in a later call.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">52</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @param verbose Logical; if \code{TRUE}, will show status messages.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @examples</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' # minimal example</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source &lt;- c(a = 1, b = 2)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' target &lt;- 1:5</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">57</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (redistribute(source, target, verbose = TRUE))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">58</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">59</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' # multi-entity example</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">60</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' source &lt;- data.frame(id = c("a", "b"), cat = c("aaa", "bbb"), num = c(1, 2))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' target &lt;- data.frame(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">62</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   id = sample(paste0(c("a", "b"), rep(1:5, 2))),</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">63</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#'   population = sample.int(1e5, 10)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">64</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' (redistribute(source, target, verbose = TRUE))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @returns A \code{data.frame} with a row for each \code{target_ids} (identified by the first column,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' \code{id}), and a column for each variable from \code{source}.</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom cli cli_abort cli_bullets cli_alert_info cli_alert_warning cli_warn</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">69</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' cli_progress_step cli_progress_update cli_progress_done</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">70</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom Rcpp sourceCpp</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">71</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom RcppParallel RcppParallelLibs</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom utils unzip</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom sf st_intersects st_intersection st_geometry st_geometry&lt;- st_crs st_geometry_type</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' st_coordinates st_centroid st_boundary st_cast st_polygon st_union st_transform st_buffer</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom s2 s2_area s2_is_valid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom lingmatch lma_simets</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom jsonlite read_json write_json</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">78</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom curl curl_fetch_disk</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom vroom vroom vroom_write</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom stats rbeta rbinom rnorm rpois</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">81</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @importFrom Matrix Matrix drop0</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">82</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @useDynLib redistribute, .registration = TRUE</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#' @export</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">85</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">redistribute &lt;- function(source, target = NULL, map = list(), source_id = "GEOID",</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">86</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         target_id = source_id, weight = NULL, source_variable = NULL, source_value = NULL,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">87</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         aggregate = NULL, weight_agg_method = "auto", default_value = NA, outFile = NULL,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">88</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         overwrite = FALSE, make_intersect_map = FALSE, overlaps = "keep", use_all = TRUE,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">89</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                         return_geometry = TRUE, return_map = FALSE, verbose = FALSE) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">90</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!overwrite &amp;&amp; !is.null(outFile) &amp;&amp; file.exists(outFile)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">91</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_abort("{.arg outFile} already exists; use {.code overwrite = TRUE} to overwrite it")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">92</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">93</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  can_intersects &lt;- missing(make_intersect_map) || make_intersect_map</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">94</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  source_sf &lt;- can_intersects &amp;&amp; (inherits(source, "sf") || inherits(source, "sfc"))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">95</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  target_sf &lt;- can_intersects &amp;&amp; (inherits(target, "sf") || inherits(target, "sfc"))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">96</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  intersect_map &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(dim(source)) != 2) source &lt;- t(source)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">98</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (is.null(colnames(source))) colnames(source) &lt;- paste0("V", seq_len(ncol(source)))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">99</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(source_id) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">100</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("source IDs: {.arg source_id} vector")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">101</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sid &lt;- source_id</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">102</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (source_id %in% colnames(source)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("source IDs: {.field {source_id}} column of {.arg source}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">104</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sid &lt;- source[, source_id, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">105</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source &lt;- source[, colnames(source) != source_id, drop = FALSE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">106</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (nrow(source) == 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">107</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("source IDs: {.field 1}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sid &lt;- if (missing(source_id)) "1" else source_id</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">109</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">110</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (source_sf &amp;&amp; target_sf) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">111</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("source IDs: sequence, assuming map from geometries")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">112</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      intersect_map &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sid &lt;- seq_len(nrow(source))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">114</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">115</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("source IDs: {.field {colnames(source)[1]}} column of {.arg source}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">116</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sid &lt;- source[, 1, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      source &lt;- source[, -1, drop = FALSE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">118</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">119</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  sid &lt;- as.character(sid)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">121</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(sid) != nrow(source)) cli_abort("{.arg source_id} is not the same length as {.field nrow(source)}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">122</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (anyDuplicated(sid)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">123</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(source_variable)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if ("variable" %in% colnames(source)) source_variable &lt;- "variable"</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">125</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if ("measure" %in% colnames(source)) source_variable &lt;- "measure"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">126</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(source_value)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">128</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if ("value" %in% colnames(source)) source_value &lt;- "value"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">131</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(source_variable) || !is.null(source_value)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source_numeric &lt;- vapply(seq_len(ncol(source)), function(col) is.numeric(source[, col, drop = TRUE]), TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">133</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(source_value) &amp;&amp; any(source_numeric)) source_value &lt;- colnames(source)[which(source_numeric)[1]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">134</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(source_variable) &amp;&amp; any(!source_numeric)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">135</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      source_variable &lt;- colnames(source)[</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">136</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        which.min(vapply(which(!source_numeric), function(col) length(unique(source[, col])), 0))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">137</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">138</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">139</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">140</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_alert_info(paste(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">141</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "converting {.arg source} format, breaking",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">142</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (length(source_value) == 1) "{.field {source_value}}" else "{.arg source_value}",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">143</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "values across",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">144</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (length(source_variable) == 1) "{.field {source_variable}}" else "{.arg source_variable}",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">145</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "columns"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">146</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">147</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">148</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    usid &lt;- unique(sid)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">149</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    nr &lt;- nrow(source)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">150</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(source_value) != nr) source_value &lt;- source[, source_value, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">151</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(source_variable) != nr) source_variable &lt;- source[, source_variable, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">152</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ss &lt;- split(data.frame(sid, source_value), source_variable)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">153</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source &lt;- do.call(cbind, lapply(ss, function(vd) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">154</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vd &lt;- vd[!duplicated(vd[[1]]), ]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">155</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      rownames(vd) &lt;- vd[, 1]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">156</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vd[usid, 2, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">157</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">158</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    colnames(source) &lt;- names(ss)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source &lt;- as.data.frame(source)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">160</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    sid &lt;- usid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">162</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(dim(target)) == 2 &amp;&amp; is.null(colnames(target))) colnames(target) &lt;- paste0("V", seq_len(ncol(target)))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">163</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(target) == 1 &amp;&amp; is.numeric(target)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">164</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("target IDs: first {.field {target}} characters of {.arg source} IDs")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">165</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- target &lt;- unique(substring(sid, 1, target))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (length(target_id) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">167</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("target IDs: {.arg target_id} vector")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">168</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- target_id</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">169</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (is.null(target)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">170</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("target IDs: {.field 1}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">171</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">172</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (!is.null(target_id) &amp;&amp; length(dim(target)) == 2 &amp;&amp; target_id %in% colnames(target)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">173</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("target IDs: {.field {target_id}} column of {.arg target}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- target[, target_id, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">175</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    target &lt;- target[, colnames(target) != target_id, drop = FALSE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">176</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">177</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(dim(target)) != 2) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">178</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (is.null(weight) &amp;&amp; (target_sf || is.numeric(target)) &amp;&amp; !is.null(names(target))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">179</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (target_sf) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">180</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (verbose) cli_alert_info("target IDs: names of {.arg target} vector")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">181</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">182</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (verbose) cli_alert_info("target IDs: names of {.arg target} vector; {.arg weight} set to {.arg target}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">183</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          weight &lt;- unname(target)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">184</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">185</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        tid &lt;- names(target)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">186</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">187</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (target_sf) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">188</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (verbose) cli_alert_info("target IDs: sequence")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">189</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          tid &lt;- seq_along(target)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">190</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">191</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (verbose) cli_alert_info("target IDs: {.arg target} vector")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">192</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          tid &lt;- target</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">193</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">194</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">195</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">196</td>
                    <td class="coverage">7<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (can_intersects &amp;&amp; target_sf &amp;&amp; source_sf) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">197</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("target IDs: sequence, assuming map from geometries")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        intersect_map &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">199</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        tid &lt;- seq_len(nrow(target))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">200</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">201</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        idi &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">202</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (length(map)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">203</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          tids &lt;- unique(unlist(map, use.names = FALSE))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">204</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (i in seq_len(ncol(target))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">205</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (any(target[, i] %in% tids)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">206</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              idi &lt;- i</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">207</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">              break</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">208</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">209</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">210</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else if (all(nchar(sid) == nchar(sid[1]))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">211</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          sl &lt;- nchar(sid[1])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">212</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (i in seq_len(ncol(target))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">213</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (any(substr(target[, i], 1, sl) %in% sid)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">214</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              idi &lt;- i</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">215</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              break</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">216</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">217</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">218</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">219</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("target IDs: {.field {colnames(target)[idi]}} column of {.arg target}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">220</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        tid &lt;- target[, idi, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">221</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        target &lt;- target[, -idi, drop = FALSE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">222</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">223</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">224</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">225</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  tid &lt;- as.character(tid)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">226</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.logical(aggregate)) aggregate &lt;- length(sid) &gt; length(tid)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">227</td>
                    <td class="coverage">3<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (make_intersect_map &amp;&amp; source_sf &amp;&amp; target_sf) intersect_map &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">228</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (length(map)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">229</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("map: provided list")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">230</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    intersect_map &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">231</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (is.null(names(map))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">232</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (length(map) != length(sid)) cli_abort("{.arg map} has no names, and is not the same length as source IDs")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">233</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      names(map) &lt;- sid</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">234</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (!any(sid %in% names(map))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">235</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (!any(tid %in% names(map))) cli_abort("no source or target IDs were in map names")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">236</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      mw &lt;- unlist(unname(map))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">237</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (is.null(names(mw))) mw &lt;- structure(numeric(length(mw)) + 1, names = mw)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">238</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      onames &lt;- names(mw)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">239</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (!any(sid %in% onames)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">240</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (all(!grepl("[^0-9]", onames))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">241</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          onames &lt;- as.integer(onames)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">242</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (min(onames) &gt; 0 &amp;&amp; max(onames) &lt;= length(sid)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">243</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (verbose) cli_alert_info("inverting map, with entry values mapped to source IDs")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">244</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            names(mw) &lt;- rep(names(map), vapply(map, length, 0))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">245</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            map &lt;- split(mw, sid[onames])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">246</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">247</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            cli_abort("map appeared to refer to target indices, but they are out of range")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">248</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">249</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">250</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          cli_abort("no source IDs were present in the ID map")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">251</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">252</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">253</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (verbose) cli_alert_info("inverting map")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">254</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        names(mw) &lt;- rep(names(map), vapply(map, length, 0))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">255</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        map &lt;- split(mw, onames)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">256</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">257</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">258</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">259</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (nrow(source) == 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">260</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("map: all target IDs for single source")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">261</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      intersect_map &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">262</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map[[sid]] &lt;- tid</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">263</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (is.null(target) || length(tid) == 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">264</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("map: all source IDs to a single target")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">265</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      intersect_map &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">266</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- as.list(structure(rep(tid, length(sid)), names = sid))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">267</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (aggregate &amp;&amp; !intersect_map &amp;&amp; all(nchar(tid) == nchar(tid[1])) &amp;&amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">268</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      nchar(sid[1]) &gt; nchar(tid[1]) &amp;&amp; any(substring(sid, 1, nchar(tid[1])) %in% tid)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">269</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("map: first {.field {nchar(tid[1])}} character{?s} of source IDs")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">270</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      intersect_map &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">271</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- as.list(structure(substr(sid, 1, nchar(tid[1])), names = sid))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">272</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (!intersect_map &amp;&amp; all(nchar(sid) == nchar(sid[1])) &amp;&amp; nchar(tid[1]) &gt; nchar(sid[1]) &amp;&amp;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">273</td>
                    <td class="coverage">9<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      any(substring(tid, 1, nchar(sid[1])) %in% sid)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">274</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) cli_alert_info("map: first {.field {nchar(sid[1])}} character{?s} of target IDs")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">275</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- split(tid, substr(tid, 1, nchar(sid[1])))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">276</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (can_intersects &amp;&amp; source_sf &amp;&amp; target_sf) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">277</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">278</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_alert_info("map: intersections between geometries")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">279</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_progress_step("mapping...", msg_done = "done mapping")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">280</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">281</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      intersect_map &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">282</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      op &lt;- options(sf_use_s2 = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">283</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      on.exit(options(sf_use_s2 = op[[1]]))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">284</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (st_crs(source) != st_crs(target)) target &lt;- st_transform(target, st_crs(source))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">285</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- tryCatch(suppressMessages(st_intersects(st_geometry(source), st_geometry(target))), error = function(e) NULL)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">286</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (is.null(map)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">287</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        cli_abort(c(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">288</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          x = "{.fn st_intersects} failed between {.arg source} and {.arg target}",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">289</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          i = "if you can do this or similar separetely, you can pass the result as {.arg map}"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">290</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">291</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">292</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      names(map) &lt;- sid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">293</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">294</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_abort("no map was provided, and it could not be made from IDs")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">295</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">296</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">297</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (aggregate &amp;&amp; length(map) == length(tid) &amp;&amp; length(map) != length(sid)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">298</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ids &lt;- if (is.null(names(map))) seq_along(map) else names(map)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">299</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    names(map) &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">300</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    child_counts &lt;- vapply(map, length, 0)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">301</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    map &lt;- as.list(unlist(map))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">302</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    names(map) &lt;- rep(ids, child_counts)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">303</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">304</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (intersect_map) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">305</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (st_crs(source) != st_crs(target)) target &lt;- st_transform(target, st_crs(source))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">306</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source_geom &lt;- st_geometry(source)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">307</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    names(source_geom) &lt;- sid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">308</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">309</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if ((is.logical(overlaps) &amp;&amp; overlaps) || grepl("^[Kk]", overlaps)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">310</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dodedupe &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">311</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">312</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tiebreak &lt;- c(f = "first", l = "last", r = "random")[tolower(substring(overlaps, 1, 1))]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">313</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dodedupe &lt;- !is.na(tiebreak)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">314</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    deduper &lt;- function(e, agg = TRUE, tm = tiebreak) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">315</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      su &lt;- which(e == max(e))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">316</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (length(su) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">317</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        su &lt;- switch(tm,</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">318</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          first = su[1],</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">319</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          last = su[length(su)],</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">320</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          random = sample(su, 1)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">321</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">322</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">323</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (agg) e[su] else su</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">324</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">325</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">326</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  any_partial &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">327</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  map &lt;- map[sid]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">328</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  mls &lt;- vapply(map, length, 0)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">329</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  polys &lt;- intersect_map &amp;&amp; any(grepl("POLY", st_geometry_type(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">330</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (aggregate) source_geom else st_geometry(target)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">331</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ), fixed = TRUE))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">332</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (polys &amp;&amp; any(mls &gt; 1)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">333</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    map &lt;- lapply(sid, function(id) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">334</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      e &lt;- map[[id]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">335</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (length(e)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">336</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        res &lt;- if (is.null(names(e))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">337</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          w &lt;- rep(1, length(e))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">338</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (intersect_map &amp;&amp; length(e) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">339</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            reg &lt;- st_geometry(target)[e]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">340</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            totals &lt;- s2_area(reg)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">341</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            su &lt;- totals &gt; 0</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">342</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (any(su)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">343</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              part &lt;- suppressMessages(st_intersection(reg[su], source_geom[id], model = "closed"))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">344</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              pv &lt;- numeric(length(part))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">345</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              tsu &lt;- s2_is_valid(part)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">346</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              pv[tsu] &lt;- s2_area(part[tsu])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">347</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              w[su] &lt;- pv / (if (aggregate) s2_area(source_geom[[id]]) else totals[su])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">348</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">349</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">350</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          names(w) &lt;- if (is.integer(e)) tid[e] else e</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">351</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          w[w &gt; 0]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">352</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">353</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          e</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">354</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">355</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (aggregate &amp;&amp; dodedupe) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">356</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (length(res) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">357</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            deduper(res)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">358</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">359</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">            res</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">360</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">361</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">362</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (!aggregate &amp;&amp; any(res &lt; 1)) any_partial &lt;&lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">363</td>
                    <td class="coverage">94<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          res</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">364</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">365</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">366</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        numeric()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">367</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">368</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">369</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">370</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    map &lt;- lapply(map, function(e) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">371</td>
                    <td class="coverage">75<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (is.null(names(e))) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">372</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        w &lt;- rep(1, length(e))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">373</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        names(w) &lt;- if (is.integer(e)) tid[e] else e</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">374</td>
                    <td class="coverage">28<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        e &lt;- w</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">375</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">376</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (!aggregate &amp;&amp; any(e &lt; 1)) any_partial &lt;&lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">377</td>
                    <td class="coverage">75<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      e</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">378</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    })</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">379</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">380</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (dodedupe &amp;&amp; any_partial) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">381</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("assigning each target to a single source")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">382</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    any_partial &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">383</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    targets &lt;- unlist(unname(map))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">384</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    esids &lt;- factor(rep(sid, vapply(map, length, 0)), unique(sid))</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">385</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (anyDuplicated(names(targets))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">386</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      for (ct in unique(names(targets))) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">387</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        su &lt;- which(names(targets) == ct)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">388</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (length(su) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">389</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          sel &lt;- deduper(targets[su], FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">390</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          targets[su[-sel]] &lt;- 0</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">391</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          targets[su[sel]] &lt;- 1</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">392</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">393</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">394</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      su &lt;- which(targets != 0)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">395</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- split(targets[su], esids[su])</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">396</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">397</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      targets[] &lt;- 1L</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">398</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      map &lt;- split(targets, esids)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">399</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">400</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">401</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    names(map) &lt;- sid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">402</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">403</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose &amp;&amp; intersect_map) cli_progress_done()</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">404</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (return_map) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">405</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("returning map")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">406</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    return(map)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">407</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">408</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  mtid &lt;- unlist(lapply(map, names), use.names = FALSE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">409</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  nout &lt;- length(if (aggregate) sid else tid)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">410</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  w &lt;- if (length(weight) &gt; 1) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">411</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("weights: {.arg weight} vector")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">412</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (length(weight) != nout) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">413</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_abort("{.arg weight} is not the same length as {.arg {if (aggregate) 'source' else 'target'}} IDs")</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">414</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">415</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    weight</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">416</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (aggregate &amp;&amp; !is.null(weight) &amp;&amp; weight %in% colnames(source)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">417</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("weights: {.field {weight}} column of {.arg source}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">418</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    w &lt;- source[, weight, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">419</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    source &lt;- source[, colnames(weight) != weight, drop = FALSE]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">420</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    w</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">421</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else if (!is.null(weight) &amp;&amp; weight %in% colnames(target)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">422</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("weights: {.field {weight}} column of {.arg target}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">423</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    target[, weight, drop = TRUE]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">424</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">425</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    weight &lt;- if (!is.numeric(weight)) 1 else weight</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">426</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("weights: {.field {weight}}")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">427</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rep(weight, nout)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">428</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">429</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  w &lt;- as.numeric(w)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">430</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  realign &lt;- FALSE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">431</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  su &lt;- tid %in% mtid</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">432</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!all(su)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">433</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">434</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      cli_alert_info(paste(</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">435</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "{.field {sum(!su)}} of {.field {length(su)}} target IDs",</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">436</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        "were dropped because they were not present in {.arg map}"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">437</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      ))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">438</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">439</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    realign &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">440</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    otid &lt;- tid</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">441</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- tid[su]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">442</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!aggregate) w &lt;- w[su]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">443</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">444</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!aggregate &amp;&amp; anyDuplicated(tid)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">445</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!realign) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">446</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      realign &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">447</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      otid &lt;- tid</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">448</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">449</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    agger &lt;- if (weight_agg_method == "auto") {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">450</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (all(w == as.integer(w))) "summing" else "averaging"</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">451</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    } else if (grepl("^[Ss]", weight_agg_method)) "summing" else "averaging"</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">452</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("{.arg target_id} contains duplicates, so {agger} {.arg weight}s")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">453</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    w &lt;- tapply(w, tid, if (agger == "summing") sum else mean)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">454</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    tid &lt;- names(w)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">455</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    w &lt;- unname(w)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">456</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">457</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (inherits(source, "sf")) st_geometry(source) &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">458</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  source_numeric &lt;- vapply(seq_len(ncol(source)), function(col) is.numeric(source[, col, drop = TRUE]), TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">459</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!all(source_numeric)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">460</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    non_numeric &lt;- which(!source_numeric)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">461</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    level_map &lt;- list()</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">462</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (col in non_numeric) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">463</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      x &lt;- as.factor(source[, col, drop = TRUE])</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">464</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      source[, col] &lt;- as.numeric(x)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">465</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      level_map[[as.character(col)]] &lt;- list(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">466</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        index = col,</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">467</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        levels = levels(x)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">468</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      )</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">469</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">470</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">471</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">472</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_alert_info(paste(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">473</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "redistributing {.field {length(source_numeric)}} variable{?s}",</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">474</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "from {.field {length(sid)}} source{?s} to {.field {length(tid)}} target{?s}:"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">475</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">476</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    var_groups &lt;- split(colnames(source), !source_numeric)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">477</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    names(var_groups) &lt;- c(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">478</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      "TRUE" = "(char; {sum(!source_numeric)})", "FALSE" = "(numb; {sum(source_numeric)})"</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">479</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    )[names(var_groups)]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">480</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_bullets(structure(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">481</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vapply(names(var_groups), function(type) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">482</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        paste(type, if (length(var_groups[[type]]) &lt; 10) paste(var_groups[[type]], collapse = ", "))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">483</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }, ""),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">484</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      names = rep("*", length(var_groups))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">485</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    ))</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">486</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    type &lt;- if (aggregate) "aggregating" else "disaggregating"</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">487</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    cli_progress_step(paste0(type, "..."), msg_done = paste("done", type))</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">488</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">489</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  method &lt;- as.integer(source_numeric)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">490</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (any_partial) aggregate &lt;- TRUE</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">491</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (aggregate) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">492</td>
                    <td class="coverage">5<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    method &lt;- method + 10</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">493</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (any_partial) method[method == 11] &lt;- 12</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">494</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">495</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  balance &lt;- any_partial &amp;&amp; (!is.logical(use_all) || use_all)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">496</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res &lt;- process_distribute(as.matrix(source), method, tid, w, map, aggregate, balance)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">497</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res &lt;- as.data.frame(res)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">498</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  colnames(res) &lt;- colnames(source)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">499</td>
                    <td class="coverage">1<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (verbose) cli_progress_done()</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">500</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!all(source_numeric)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">501</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("re-converting categorical levels")</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">502</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (l in level_map) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">503</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      x &lt;- res[, l$index]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">504</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      x[x == 0] &lt;- NA</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">505</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      res[, l$index] &lt;- l$levels[x]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">506</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">507</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">508</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res &lt;- cbind(id = tid, res)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">509</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (realign) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">510</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_alert_info("realigning with original target IDs")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">511</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rownames(res) &lt;- tid</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">512</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    res &lt;- res[otid, ]</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">513</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    res$id &lt;- otid</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">514</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!is.na(default_value)) res[!res$id %in% tid, -1] &lt;- default_value</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">515</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    rownames(res) &lt;- NULL</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">516</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">517</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (!is.null(outFile)) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">518</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_progress_step("writing results to {.file {outFile}}")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">519</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    dir.create(dirname(outFile), FALSE, TRUE)</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">520</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (!grepl("\\.\\w", outFile)) outFile &lt;- paste0(outFile, ".csv")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">521</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    vroom_write(res, outFile, ",")</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">522</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (verbose) cli_progress_done()</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">523</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">524</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (return_geometry &amp;&amp; target_sf) st_geometry(res) &lt;- st_geometry(target)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">525</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  invisible(res)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">526</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="src/generate_individuals.cpp" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">// [[Rcpp::depends(RcppParallel)]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#include &lt;Rcpp.h&gt;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#include &lt;RcppParallel.h&gt;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">using namespace std;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">using namespace Rcpp;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">using namespace RcppParallel;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">8</td>
                    <td class="coverage">11992<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">const int select(const vector&lt;int&gt; &amp;local, const NumericVector &amp;base) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">9</td>
                    <td class="coverage">11992<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int n = local.size();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">10</td>
                    <td class="coverage">11992<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  int sel = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">11</td>
                    <td class="coverage">11992<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  double prob, sel_prob = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">12</td>
                    <td class="coverage">83945<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = n; i--;) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">13</td>
                    <td class="coverage">71952<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    prob = R::rbinom(n, local[i] ? local[i] / n * base[i] : base[i]);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">14</td>
                    <td class="coverage">71953<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (prob &gt; sel_prob) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">15</td>
                    <td class="coverage">6849<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sel = i;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">16</td>
                    <td class="coverage">6849<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sel_prob = prob;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">17</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">18</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">19</td>
                    <td class="coverage">11993<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return sel;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">20</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">21</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">22</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">struct Generate : public Worker {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">23</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  RVector&lt;double&gt; individuals;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">24</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const vector&lt;int&gt; start, end;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">25</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const IntegerVector region, head_income, size, renting, space_i, space_p;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">26</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const NumericVector space_x, race_rates;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">27</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int N, n_neighbors, n_races = race_rates.length(), nh = region.length();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">28</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  Generate(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    NumericVector &amp;individuals, const vector&lt;int&gt; &amp;start, const vector&lt;int&gt; &amp;end,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const IntegerVector &amp;region, const IntegerVector &amp;head_income, const IntegerVector &amp;size,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const IntegerVector &amp;renting, const S4 &amp;space, const NumericVector &amp;race_rates,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int &amp;N, const double &amp;n_neighbors</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ):</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    individuals(individuals), start(start), end(end), region(region),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">35</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    head_income(head_income), size(size), renting(renting), space_i(space.slot("i")),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">36</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    space_p(space.slot("p")), space_x(space.slot("x")), race_rates(race_rates), N(N),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">37</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    n_neighbors(n_neighbors)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  {}</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">39</td>
                    <td class="coverage">3632<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  void operator()(size_t s, size_t e){</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">40</td>
                    <td class="coverage">3632<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    int ck = 1e3;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">41</td>
                    <td class="coverage">14529<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    vector&lt;int&gt; neighbors(n_neighbors), race_table(n_races);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">42</td>
                    <td class="coverage">13630<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (; s &lt; e; s++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">43</td>
                    <td class="coverage">9995<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const int ci = s, r = region[s] - 1, inc = head_income[s], n = size[s],</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">44</td>
                    <td class="coverage">9992<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ro = renting[s], ie = end[s];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">45</td>
                    <td class="coverage">9996<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      int i = 0, nn = 0, nni, nhi = space_p[r], nhn = space_p[r + 1], h1, h2;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">46</td>
                    <td class="coverage">9985<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      double ns = 0;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      // summarize neighbors</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">49</td>
                    <td class="coverage">19985<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vector&lt;int&gt; neighbor_index;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">50</td>
                    <td class="coverage">19997<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      vector&lt;double&gt; neighbor_sims;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      // // find neighbors in range</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">52</td>
                    <td class="coverage">14523775<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      for (; i &lt; nh; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">53</td>
                    <td class="coverage">14513781<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (i != ci) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">54</td>
                    <td class="coverage">16537788<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          const int nr = region[i] - 1;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">55</td>
                    <td class="coverage">13103246<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          ns = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">56</td>
                    <td class="coverage">24559682<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (nni = nhi; nni &lt; nhn; nni++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">57</td>
                    <td class="coverage">16602227<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (space_i[nni] == nr) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">58</td>
                    <td class="coverage">1469020<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              ns = space_x[nni];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">59</td>
                    <td class="coverage">1484081<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              break;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">60</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">61</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">62</td>
                    <td class="coverage">9441536<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (ns) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">63</td>
                    <td class="coverage">1486528<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (nn &lt; n_neighbors) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">64</td>
                    <td class="coverage">412390<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              neighbor_index.push_back(i);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">65</td>
                    <td class="coverage">415235<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              neighbor_sims.push_back(ns);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">66</td>
                    <td class="coverage">416403<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              nn++;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">68</td>
                    <td class="coverage">1074138<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              ns += R::rnorm(0, 1e-5);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">69</td>
                    <td class="coverage">32819157<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              for (nni = nn; nni--;) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">32228378<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                if (ns &gt; neighbor_sims[nni]) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">71</td>
                    <td class="coverage">554614<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                  neighbor_index[nni] = i;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">72</td>
                    <td class="coverage">570458<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                  neighbor_sims[nni] = ns;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">73</td>
                    <td class="coverage">547914<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                  break;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">75</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">76</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">77</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">78</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">80</td>
                    <td class="coverage">9994<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (nn) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">81</td>
                    <td class="coverage">9085<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        int ni = n_neighbors;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">82</td>
                    <td class="coverage">463233<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        for (; ni--;) neighbors[ni] = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">83</td>
                    <td class="coverage">63628<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        for (ni = n_races; ni--;) race_table[ni] = 0;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        // see if neighbors have been filled, and summarize over their household members</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">85</td>
                    <td class="coverage">426090<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        for (ni = nn, nn = 0; ni--;) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">417000<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          nni = neighbor_index[ni], nhi = start[nni], nhn = min(nhi + 2, end[nni]);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">87</td>
                    <td class="coverage">417036<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (individuals[nhi]) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">88</td>
                    <td class="coverage">674626<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            for (; nhi &lt; nhn; nhi++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">89</td>
                    <td class="coverage">422568<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              neighbors[0] += individuals[nhi + 3 * N]; // sum age</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">90</td>
                    <td class="coverage">422556<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              neighbors[1] += individuals[nhi + 4 * N]; // n 1 sex</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">91</td>
                    <td class="coverage">422560<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              race_table[individuals[nhi + 5 * N]]++;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">92</td>
                    <td class="coverage">422566<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              neighbors[3] += individuals[nhi + 6 * N]; // sum income</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">93</td>
                    <td class="coverage">422565<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              nn++;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">94</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">96</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">97</td>
                    <td class="coverage">9090<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (nn) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">98</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          // finalize neighbor summaries</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">99</td>
                    <td class="coverage">8551<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          ni = n_races, i = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">59857<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (int m = -1; ni--;) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">101</td>
                    <td class="coverage">51306<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            if (race_table[ni] &gt; m) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">102</td>
                    <td class="coverage">22765<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              i = ni;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">103</td>
                    <td class="coverage">22765<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              m = race_table[ni];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">104</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">105</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">106</td>
                    <td class="coverage">8551<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          neighbors[0] /= nn;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">8551<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          neighbors[2] = i;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">108</td>
                    <td class="coverage">8551<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          neighbors[3] /= nn;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">109</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">110</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">111</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">112</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      // fill out household members</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">9999<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      int hage = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">114</td>
                    <td class="coverage">30659<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      for (i = start[s], h1 = i, h2 = i + 1; i &lt; ie; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">115</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        // set household and individual ids</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">116</td>
                    <td class="coverage">20658<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const int row = i;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">20658<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        individuals[row] = s + 1;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">118</td>
                    <td class="coverage">20658<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        individuals[row + N] = row + 1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">119</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">120</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        // set number of neighbors (col 3)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">121</td>
                    <td class="coverage">20659<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        individuals[row + 2 * N] = nn;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">122</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">123</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        // select age (col 4)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">20660<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (row == h1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">125</td>
                    <td class="coverage">10001<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          hage = floor(R::rbeta(1, ro ? 2 : 1.5) * 80 + 18);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">126</td>
                    <td class="coverage">10001<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (nn) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">127</td>
                    <td class="coverage">8550<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            hage = max(18, (int)ceil((hage + R::rnorm(neighbors[0], 5)) / 2));</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">128</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">129</td>
                    <td class="coverage">10002<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 3 * N] = hage;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">130</td>
                    <td class="coverage">10659<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else if (row == h2) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">131</td>
                    <td class="coverage">6529<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 3 * N] = max(18, min((int)floor(R::rnorm(hage, hage &gt; 40 ? 15 : 5)), 90));</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">132</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">133</td>
                    <td class="coverage">4130<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 3 * N] = ceil(R::runif(0, 1) * (hage - 15));</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">134</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">135</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">136</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        // select sex (col 5)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">20661<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (row == h2) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">6529<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 4 * N] = R::rbinom(1, .1) ? individuals[row - 1 + 4 * N] : (int)!individuals[row - 1 + 4 * N];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">139</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">14132<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 4 * N] = R::rbinom(1, .5);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">141</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">142</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">143</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        // select race (col 6)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">144</td>
                    <td class="coverage">20661<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (row == h1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">145</td>
                    <td class="coverage">10002<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 5 * N] = select(race_table, race_rates);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">146</td>
                    <td class="coverage">10659<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else if (row == h2) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">147</td>
                    <td class="coverage">6529<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 5 * N] = R::rbinom(1, .7) ? individuals[row - 1 + 5 * N] : select(race_table, race_rates);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">148</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">149</td>
                    <td class="coverage">4130<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 5 * N] = individuals[row - (1 + R::rbinom(1, .5)) + 5 * N];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">150</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">151</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">152</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        // select income (col 7)</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">153</td>
                    <td class="coverage">20661<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (row == h1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">154</td>
                    <td class="coverage">10002<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 6 * N] = inc;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">155</td>
                    <td class="coverage">10659<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else if (row == h2) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">156</td>
                    <td class="coverage">6529<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          individuals[row + 6 * N] = inc &lt; (nn ? neighbors[3] : 4e4) || n == 2 ? max(0, (int)floor(R::rnorm(inc, 2e4))) : 0;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">157</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">158</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">10002<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (!--ck) {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">160</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        checkUserInterrupt();</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">161</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        ck = 1e3;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">162</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">163</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">164</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">165</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">};</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">166</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">167</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">// [[Rcpp::export]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">168</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">NumericVector generate_individuals(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">169</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const IntegerVector &amp;region, const IntegerVector &amp;head_income, const IntegerVector &amp;size,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">170</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const IntegerVector &amp;renting, const S4 &amp;space, const int &amp;n_neighbors,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">171</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const NumericVector &amp;race_rates</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">172</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">173</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int nh = size.length(), nvars = 7;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">174</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">175</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  // map sets of individuals</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">176</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  vector&lt;int&gt; start(nh), end(nh);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">177</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  int n = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">178</td>
                    <td class="coverage">10004<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = 0; i &lt; nh; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">179</td>
                    <td class="coverage">10002<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    start[i] = n;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">180</td>
                    <td class="coverage">10002<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    n += size[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">181</td>
                    <td class="coverage">10002<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    end[i] = n;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">182</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">183</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">184</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  NumericVector individuals(n * nvars);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">185</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  Generate g(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">186</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    individuals, start, end, region, head_income, size, renting, space, race_rates, n, n_neighbors</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">187</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  );</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">188</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  parallelFor(0, nh, g);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">189</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">190</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  individuals.attr("dim") = Dimension(n, nvars);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">191</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  individuals.attr("dimnames") = List::create(R_NilValue, CharacterVector::create(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">192</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    "household", "person", "neighbors", "age", "sex", "race", "income"</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">193</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ));</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">194</td>
                    <td class="coverage">4<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return individuals;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">195</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="src/redistribute.cpp" class="hidden">
              <table class="table-condensed">
                <tbody>
                  <tr class="never">
                    <td class="num">1</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">// [[Rcpp::depends(RcppParallel)]]</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">2</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#include &lt;Rcpp.h&gt;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">3</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#include &lt;RcppParallel.h&gt;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">4</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">#include &lt;unordered_map&gt;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">5</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">using namespace std;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">6</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">using namespace Rcpp;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">7</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">using namespace RcppParallel;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">8</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">9</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">const int aggregate_mode(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">10</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int &amp;os, const RMatrix&lt;double&gt; &amp;source, const int &amp;tstart, const int &amp;tend,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">11</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const vector&lt;int&gt; &amp;source_rows, const vector&lt;double&gt; &amp;iw</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">12</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">13</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bool any = false;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">14</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  double max = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">15</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  int max_cat = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">16</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  unordered_map&lt;int, double&gt; acc;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">17</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">18</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = source_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">19</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int cat = source[r + os];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">20</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (isfinite(cat)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">21</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      any = true;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">22</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (acc.find(cat) == acc.end()) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">23</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        acc.insert({cat, iw[i]});</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">24</td>
                    <td class="coverage">8<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else acc.at(cat) += iw[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">25</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const double count = acc.at(cat);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">26</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (count &gt; max) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">27</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        max = count;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">28</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        max_cat = cat;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">29</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">30</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">31</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">32</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return any ? max_cat : NA_INTEGER;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">33</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">34</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">35</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">const double aggregate_sum(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">36</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int &amp;os, const RMatrix&lt;double&gt; &amp;source, const int &amp;tstart, const int &amp;tend,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">37</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const vector&lt;int&gt; &amp;source_rows, const RVector&lt;double&gt; &amp;w, const vector&lt;double&gt; &amp;iw</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">38</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">39</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bool any = false;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">40</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  double sum = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">41</td>
                    <td class="coverage">324<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">42</td>
                    <td class="coverage">310<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = source_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">43</td>
                    <td class="coverage">310<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const double v = source[r + os];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">44</td>
                    <td class="coverage">310<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (isfinite(v)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">45</td>
                    <td class="coverage">310<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      any = true;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">46</td>
                    <td class="coverage">310<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      sum += v * iw[i] * w[r];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">47</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">48</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">49</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return any ? sum : NA_REAL;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">50</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">51</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">52</td>
                    <td class="coverage">270<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">const double proportional_aggregate(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">53</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int &amp;os, const RMatrix&lt;double&gt; &amp;source, const int &amp;tstart, const int &amp;tend,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">54</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const vector&lt;int&gt; &amp;source_rows, const RVector&lt;double&gt; &amp;w, const vector&lt;double&gt; &amp;iw,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">55</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const vector&lt;double&gt; &amp;totals, const size_t &amp;s</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">56</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">57</td>
                    <td class="coverage">270<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  bool any = false;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">58</td>
                    <td class="coverage">270<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  double sum = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">59</td>
                    <td class="coverage">570<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">60</td>
                    <td class="coverage">300<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = source_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">61</td>
                    <td class="coverage">300<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const double v = source[r + os];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">62</td>
                    <td class="coverage">300<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    if (isfinite(v)) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">63</td>
                    <td class="coverage">300<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      any = true;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">64</td>
                    <td class="coverage">300<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (totals[r]) sum += v * iw[i] * w[s] / totals[r];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">65</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">66</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">67</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return any ? sum : NA_REAL;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">68</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">69</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">70</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">void proportional_categoric(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">71</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const int &amp;os, const int &amp;s, const int &amp;tstart, const int &amp;tend, const vector&lt;int&gt; &amp;target_rows,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">72</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    RVector&lt;double&gt; &amp;v, const vector&lt;double&gt; &amp;iw</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">73</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">74</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int val = isfinite(s) ? s : NA_REAL;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">75</td>
                    <td class="coverage">36<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">76</td>
                    <td class="coverage">30<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = target_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">77</td>
                    <td class="coverage">30<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    v[r + os] = val;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">78</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">79</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">80</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">81</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">void proportional_numeric(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">82</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int &amp;os, const double &amp;s, const int &amp;tstart, const int &amp;tend, const vector&lt;int&gt; &amp;target_rows,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">83</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const RVector&lt;double&gt; &amp;w, const double &amp;total, RVector&lt;double&gt; &amp;v, const vector&lt;double&gt; &amp;iw</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">84</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">85</td>
                    <td class="coverage">252<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  for (int i = tstart, r; i &lt; tend; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">86</td>
                    <td class="coverage">220<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    r = target_rows[i];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">87</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    v[r + os] = isfinite(s) ? s * iw[i] * w[r] / total : NA_REAL;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">88</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">89</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">90</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">91</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">struct Distribute : public Worker {</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">92</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  RVector&lt;double&gt; res;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">93</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const RMatrix&lt;double&gt; source;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">94</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const vector&lt;int&gt; start, end, index;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">95</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const RVector&lt;double&gt; weight;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">96</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const vector&lt;double&gt; index_weight, weight_totals;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">97</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const RVector&lt;int&gt; method;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">98</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const bool agg;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">99</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int ncol = method.length(), n = agg ? source.nrow() : weight.length(), on = start.size();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">100</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  Distribute(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">101</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    NumericVector &amp;res, const NumericMatrix &amp;source,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">102</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const vector&lt;int&gt; &amp;start, const vector&lt;int&gt; &amp;end, const vector&lt;int&gt; &amp;index,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">103</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const NumericVector &amp;weight, const vector&lt;double&gt; &amp;index_weight, const vector&lt;double&gt; &amp;weight_totals,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">104</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const IntegerVector &amp;method, const bool &amp;agg</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">105</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ):</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">106</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    res(res), source(source), start(start), end(end), index(index), weight(weight),</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">107</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    index_weight(index_weight), weight_totals(weight_totals), method(method), agg(agg)</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">108</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  {}</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">109</td>
                    <td class="coverage">114<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  void operator()(size_t s, size_t e){</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">110</td>
                    <td class="coverage">114<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    int c = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">111</td>
                    <td class="coverage">228<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (; s &lt; e; s++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">112</td>
                    <td class="coverage">114<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const int ss = start[s], se = end[s] + 1;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">113</td>
                    <td class="coverage">114<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (ss &gt; -1) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">114</td>
                    <td class="coverage">114<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (agg) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">115</td>
                    <td class="coverage">382<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (c = 0; c &lt; ncol; c++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">116</td>
                    <td class="coverage">286<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            const int os = c * n;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">117</td>
                    <td class="coverage">286<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            switch(method[c]) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">118</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 10:</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">119</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                res[s + c * on] = aggregate_mode(os, source, ss, se, index, index_weight);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">120</td>
                    <td class="coverage">2<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">121</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 11:</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">122</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                res[s + c * on] = aggregate_sum(os, source, ss, se, index, weight, index_weight);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">123</td>
                    <td class="coverage">14<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">124</td>
                    <td class="coverage">270<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 12:</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">125</td>
                    <td class="coverage">270<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                res[s + c * on] = proportional_aggregate(</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">126</td>
                    <td class="coverage">270<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                  os, source, ss, se, index, weight, index_weight, weight_totals, s</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">127</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                );</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">128</td>
                    <td class="coverage">270<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">129</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">130</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">131</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">132</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          const double total = weight_totals[s];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">133</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          const RMatrix&lt;double&gt;::Row source_row = source.row(s);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">134</td>
                    <td class="coverage">56<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          for (c = 0; c &lt; ncol; c++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">135</td>
                    <td class="coverage">38<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            const int os = c * n;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">136</td>
                    <td class="coverage">38<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            switch(method[c]) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">137</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 0:</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">138</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                proportional_categoric(os, source_row[c], ss, se, index, res, index_weight);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">139</td>
                    <td class="coverage">6<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">140</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">              case 1:</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">141</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                if (total) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">142</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                  proportional_numeric(os, source_row[c], ss, se, index, weight, total, res, index_weight);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">143</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">144</td>
                    <td class="coverage">32<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">                break;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">145</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">146</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">147</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">148</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">149</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">150</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">151</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">};</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">152</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">153</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">// [[Rcpp::export]]</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">154</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">NumericVector process_distribute(</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">155</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const NumericMatrix &amp;s, const IntegerVector &amp;method, const CharacterVector &amp;tid,</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">156</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    const NumericVector &amp;weight, const List &amp;map, const bool &amp;agg, const bool &amp;balance</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">157</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  ) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">158</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int source_n = s.nrow(), nvars = s.ncol(), target_n = tid.length();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">159</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  NumericVector res(nvars * target_n);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">160</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">161</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  // translate map</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">162</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  const int iter_max = agg ? target_n : source_n;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">163</td>
                    <td class="coverage">48<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  vector&lt;int&gt; start(iter_max), end(iter_max), index;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">164</td>
                    <td class="coverage">36<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  vector&lt;double&gt; weight_totals(source_n), index_weight;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">165</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  if (agg) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">166</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    unordered_map&lt;String, IntegerVector&gt; imap;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">167</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    unordered_map&lt;String, NumericVector&gt; wmap;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">168</td>
                    <td class="coverage">10<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    unordered_map&lt;String, double&gt; tmap;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">169</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    int i, t;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">170</td>
                    <td class="coverage">101<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (i = 0; i &lt; target_n; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">171</td>
                    <td class="coverage">192<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      IntegerVector indices;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">172</td>
                    <td class="coverage">192<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      NumericVector indices_weight;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">173</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const String id = tid[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">174</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      imap.insert({id, indices});</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">175</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      wmap.insert({id, indices_weight});</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">176</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      tmap.insert({id, balance ? 0 : 1});</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">177</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">178</td>
                    <td class="coverage">109<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (i = 0; i &lt; source_n; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">179</td>
                    <td class="coverage">104<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      weight_totals[i] = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">180</td>
                    <td class="coverage">208<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const NumericVector tidws = map[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">181</td>
                    <td class="coverage">104<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const int n = tidws.length();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">182</td>
                    <td class="coverage">104<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (n) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">183</td>
                    <td class="coverage">208<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const CharacterVector tids = tidws.names();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">184</td>
                    <td class="coverage">314<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        for (t = 0; t &lt; n; t++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">185</td>
                    <td class="coverage">420<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          const String id = tids[t];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">186</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          const double itw = tidws[t];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">187</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          imap.at(id).push_back(i);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">188</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          wmap.at(id).push_back(itw);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">189</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (balance) tmap.at(id) += itw;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">190</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">191</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">192</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">193</td>
                    <td class="coverage">101<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (i = 0; i &lt; target_n; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">194</td>
                    <td class="coverage">192<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const String id = tid[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">195</td>
                    <td class="coverage">192<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const IntegerVector indices = imap.at(id);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">196</td>
                    <td class="coverage">192<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const NumericVector indices_weight = wmap.at(id);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">197</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const double weight_total = tmap.at(id);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">198</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const int n = indices.length();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">199</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      bool any = false;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">200</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      start[i] = index.size();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">201</td>
                    <td class="coverage">306<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      for (t = 0; t &lt; n; t++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">202</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const int si = indices[t];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">203</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        double wi = indices_weight[t];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">204</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (balance &amp;&amp; weight_total != 1) wi /= weight_total;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">205</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        any = true;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">206</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        index.push_back(si);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">207</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        index_weight.push_back(wi);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">208</td>
                    <td class="coverage">210<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        weight_totals[si] += wi * weight[i];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">209</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">210</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (any) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">211</td>
                    <td class="coverage">96<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        end[i] = index.size() - 1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">212</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">213</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        start[i] = end[i] = -1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">214</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">215</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">216</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  } else {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">217</td>
                    <td class="coverage">25<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    for (int i = 0, t; i &lt; source_n; i++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">218</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      weight_totals[i] = 0;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">219</td>
                    <td class="coverage">36<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      const NumericVector tidws = map[i];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">220</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      if (tidws.length()) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">221</td>
                    <td class="coverage">36<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const CharacterVector tids = tidws.names();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">222</td>
                    <td class="coverage">36<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const IntegerVector indices = match(tids, tid) - 1;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">223</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        const int n = indices.length();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">224</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        bool any = false;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">225</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        start[i] = index.size();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">226</td>
                    <td class="coverage">138<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        for (t = 0; t &lt; n; t++) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">227</td>
                    <td class="coverage">120<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          const int si = indices[t];</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">228</td>
                    <td class="coverage">120<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          if (si &gt; -1 &amp;&amp; si &lt; target_n) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">229</td>
                    <td class="coverage">120<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            any = true;</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">230</td>
                    <td class="coverage">120<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            index.push_back(si);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">231</td>
                    <td class="coverage">120<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            index_weight.push_back(tidws[t]);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">232</td>
                    <td class="coverage">120<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">            weight_totals[i] += weight[si];</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">233</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">234</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">235</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        if (any) {</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">236</td>
                    <td class="coverage">18<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">          end[i] = index.size() - 1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">237</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">238</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">          start[i] = end[i] = -1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">239</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">        }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">240</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      } else {</pre>
                    </td>
                  </tr>
                  <tr class="missed">
                    <td class="num">241</td>
                    <td class="coverage">!</td>
                    <td class="col-sm-12">
                      <pre class="language-r">        start[i] = end[i] = -1;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">242</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">      }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">243</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">    }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">244</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  }</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">245</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">246</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  // process</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">247</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  Distribute distributed(res, s, start, end, index, weight, index_weight, weight_totals, method, agg);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">248</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  checkUserInterrupt();</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">249</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  parallelFor(0, iter_max, distributed);</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">250</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r"></pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">251</td>
                    <td class="coverage">12<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  res.attr("dim") = Dimension(target_n, nvars);</pre>
                    </td>
                  </tr>
                  <tr class="covered">
                    <td class="num">252</td>
                    <td class="coverage">24<em>x</em></td>
                    <td class="col-sm-12">
                      <pre class="language-r">  return res;</pre>
                    </td>
                  </tr>
                  <tr class="never">
                    <td class="num">253</td>
                    <td class="coverage"></td>
                    <td class="col-sm-12">
                      <pre class="language-r">}</pre>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <script>$('div#files pre').each(function(i, block) {
    hljs.highlightBlock(block);
});</script>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>

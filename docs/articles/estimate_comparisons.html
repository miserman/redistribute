<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="redistribute">
<title>Estimate Comparisons • redistribute</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Comparisons">
<meta property="og:description" content="redistribute">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">redistribute</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/estimate_comparisons.html">Estimate Comparisons</a>
    <a class="dropdown-item" href="../articles/introduction.html">Introduction to Redistribution</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/uva-bi-sdad/redistribute/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimate Comparisons</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/uva-bi-sdad/redistribute/blob/HEAD/vignettes/estimate_comparisons.Rmd" class="external-link"><code>vignettes/estimate_comparisons.Rmd</code></a></small>
      <div class="d-none name"><code>estimate_comparisons.Rmd</code></div>
    </div>

    
    
<p><em>Built with R 4.2.2</em></p>
<hr>
<p>Redistribution means rearranging values such that totals remain the
same, and the original distribution could be recovered when
re-aggregating from a perfectly contained disaggregate.</p>
<p>This may be desirable if your goal is to simply display the same data
in different forms.</p>
<p>If, however, your goal is to come up with values at scales you don’t
have observations of, it may be desirable to combine various
observations at different scales and use them to come up with new
estimates.</p>
<p>In the case of estimation, there are many more methods to consider,
and validating their results is less straightforward, so this article
will consider a few estimation and validation methods.</p>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>We’ll focus on a single county (Arlington, VA), with census block
groups and Public Use Microdata Samples (PUMS) as our primary source
data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># directory to save data in</span></span>
<span><span class="va">base_dir</span> <span class="op">&lt;-</span> <span class="st">"../estimate_comparison"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">base_dir</span>, <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># geographies</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">catchment</span><span class="op">)</span></span>
<span><span class="va">geography_bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/catchment/man/download_census_shapes.html" class="external-link">download_census_shapes</a></span><span class="op">(</span><span class="va">base_dir</span>, <span class="st">"va"</span>, <span class="st">"bg"</span>, year <span class="op">=</span> <span class="fl">2021</span><span class="op">)</span></span>
<span><span class="va">geography_bg</span> <span class="op">&lt;-</span> <span class="va">geography_bg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^51013"</span>, <span class="va">geography_bg</span><span class="op">$</span><span class="va">GEOID</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">geography_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/catchment/man/download_census_shapes.html" class="external-link">download_census_shapes</a></span><span class="op">(</span><span class="va">base_dir</span>, <span class="st">"va"</span>, <span class="st">"tr"</span>, year <span class="op">=</span> <span class="fl">2021</span><span class="op">)</span></span>
<span><span class="va">geography_tr</span> <span class="op">&lt;-</span> <span class="va">geography_tr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^51013"</span>, <span class="va">geography_tr</span><span class="op">$</span><span class="va">GEOID</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># ACS data</span></span>
<span></span>
<span><span class="co">## block groups</span></span>
<span><span class="va">block_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/catchment/man/download_census_population.html" class="external-link">download_census_population</a></span><span class="op">(</span></span>
<span>  <span class="va">base_dir</span>, <span class="st">"va"</span>, <span class="fl">2021</span>,</span>
<span>  counties <span class="op">=</span> <span class="fl">51013</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">estimates</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> loading existing Virginia population data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">block_groups</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Total"</span></span>
<span><span class="va">block_groups</span><span class="op">$</span><span class="va">RACE_Total_Other</span> <span class="op">&lt;-</span> <span class="va">block_groups</span><span class="op">$</span><span class="va">RACE_Total</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span></span>
<span>  <span class="va">block_groups</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^RACE_Total_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">block_groups</span><span class="op">)</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">geography_bg</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">geography_bg</span><span class="op">$</span><span class="va">GEOID</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">block_groups</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">geography_bg</span><span class="op">[</span><span class="va">block_groups</span><span class="op">$</span><span class="va">GEOID</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parcel data</span></span>
<span><span class="va">parcel_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">base_dir</span>, <span class="st">"/parcels.rds"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">parcel_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">parcels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"https://arlgis.arlingtonva.us/arcgis/rest/services/Open_Data/od_MHUD_Polygons/"</span>,</span>
<span>    <span class="st">"FeatureServer/0/query?where=1=1&amp;outFields=*&amp;outSR=4326&amp;f=json"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">parcels</span>, <span class="va">parcel_file</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">parcels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">parcel_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">parcels</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">parcels</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Total_Units"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Total"</span></span>
<span><span class="va">parcels</span><span class="op">$</span><span class="va">tract</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">parcels</span><span class="op">$</span><span class="va">Full_Block</span>, <span class="fl">1</span>, <span class="fl">11</span><span class="op">)</span></span></code></pre></div>
<p>Ultimately, we’ll want to use these methods to get values for
unobserved geographies, but for this comparison of methods, we’ll want a
way to test their results against known values.</p>
<p>For this test case, we can simply start at a higher geolayer, and
make estimates at the block group level. To do that, we’ll need to
aggregate our block group data up to tracts:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tracts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redistribute.html">redistribute</a></span><span class="op">(</span><span class="va">block_groups</span>, <span class="va">geography_tr</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<p>As a baseline, the first method to consider is proportional
redistribution of the block group summary estimates alone.</p>
<div class="section level3">
<h3 id="redistribution">Redistribution<a class="anchor" aria-label="anchor" href="#redistribution"></a>
</h3>
<div class="section level4">
<h4 id="direct">Direct<a class="anchor" aria-label="anchor" href="#direct"></a>
</h4>
<p>We could do this from tracts to block groups directly:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># going from tracts to block groups with no information</span></span>
<span><span class="va">estimate_tr_to_bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redistribute.html">redistribute</a></span><span class="op">(</span></span>
<span>  <span class="va">tracts</span>, <span class="va">block_groups</span>,</span>
<span>  source_id <span class="op">=</span> <span class="st">"id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># mean absolute error between total population estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">estimate_tr_to_bg</span><span class="op">$</span><span class="va">Total</span> <span class="op">-</span> <span class="va">block_groups</span><span class="op">$</span><span class="va">Total</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 303.938</span></span></code></pre></div>
<p>We can see in this case, the error introduce when we only have
proportional information at the lower level; block groups that once
varied within tract not have the same value:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thomasp85/scico" class="external-link">scico</a></span><span class="op">)</span></span>
<span><span class="va">theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">%+replace%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">22</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^51013100700"</span>, <span class="va">block_groups</span><span class="op">$</span><span class="va">GEOID</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">block_groups</span><span class="op">[</span><span class="va">selection</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Original"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">Total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/scico/man/ggplot2-scales.html" class="external-link">scale_fill_scico</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"lajolla"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">estimate_tr_to_bg</span><span class="op">[</span><span class="va">selection</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"From Tract"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Total</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/scico/man/ggplot2-scales.html" class="external-link">scale_fill_scico</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"lajolla"</span><span class="op">)</span></span></code></pre></div>
<p><img src="estimate_comparisons_files/figure-html/unnamed-chunk-5-1.svg" width="50%"><img src="estimate_comparisons_files/figure-html/unnamed-chunk-5-2.svg" width="50%"></p>
</div>
<div class="section level4">
<h4 id="down-and-up">Down and Up<a class="anchor" aria-label="anchor" href="#down-and-up"></a>
</h4>
<p>Or from tracts down to parcels, and back up to block groups:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># going from tracts to parcels</span></span>
<span><span class="va">map_tr_to_parcel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redistribute.html">redistribute</a></span><span class="op">(</span></span>
<span>  <span class="va">tracts</span>, <span class="va">parcels</span>,</span>
<span>  source_id <span class="op">=</span> <span class="st">"id"</span>, target_id <span class="op">=</span> <span class="st">"OBJECTID"</span>, return_map <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">estimate_tr_to_parcel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redistribute.html">redistribute</a></span><span class="op">(</span></span>
<span>  <span class="va">tracts</span>, <span class="va">parcels</span>, <span class="va">map_tr_to_parcel</span>,</span>
<span>  weight <span class="op">=</span> <span class="st">"Total"</span>, source_id <span class="op">=</span> <span class="st">"id"</span>, target_id <span class="op">=</span> <span class="st">"OBJECTID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># then from parcels to block groups</span></span>
<span><span class="va">map_parcel_to_bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redistribute.html">redistribute</a></span><span class="op">(</span></span>
<span>  <span class="va">estimate_tr_to_parcel</span>, <span class="va">block_groups</span>,</span>
<span>  source_id <span class="op">=</span> <span class="st">"id"</span>, target_id <span class="op">=</span> <span class="st">"GEOID"</span>, return_map <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">estimate_parcel_to_bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redistribute.html">redistribute</a></span><span class="op">(</span></span>
<span>  <span class="va">estimate_tr_to_parcel</span>, <span class="va">block_groups</span>, <span class="va">map_parcel_to_bg</span>,</span>
<span>  source_id <span class="op">=</span> <span class="st">"id"</span>, target_id <span class="op">=</span> <span class="st">"GEOID"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># mean absolute error between total population estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">estimate_parcel_to_bg</span><span class="op">$</span><span class="va">Total</span> <span class="op">-</span> <span class="va">block_groups</span><span class="op">$</span><span class="va">Total</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 221.9761</span></span></code></pre></div>
<p>Now there is more of the original variation between block groups:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redistribute.html">redistribute</a></span><span class="op">(</span></span>
<span>  <span class="va">block_groups</span>, <span class="va">estimate_tr_to_parcel</span>,</span>
<span>  return_map <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">parcel_selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">map</span><span class="op">[</span><span class="va">selection</span><span class="op">]</span>, <span class="va">names</span><span class="op">)</span>,</span>
<span>  use.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">block_groups</span><span class="op">[</span><span class="va">selection</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Original"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">Total</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/scico/man/ggplot2-scales.html" class="external-link">scale_fill_scico</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"lajolla"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"From Parcels From Tract"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/scico/man/ggplot2-scales.html" class="external-link">scale_fill_scico</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"lajolla"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Total</span><span class="op">)</span>,</span>
<span>    <span class="va">estimate_parcel_to_bg</span><span class="op">[</span><span class="va">selection</span>, <span class="st">"Total"</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Total</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span></span>
<span>    <span class="va">parcels</span><span class="op">[</span><span class="va">parcel_selection</span>, <span class="st">"Total"</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">estimate_parcel_to_bg</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="estimate_comparisons_files/figure-html/unnamed-chunk-7-1.svg" width="50%"><img src="estimate_comparisons_files/figure-html/unnamed-chunk-7-2.svg" width="50%"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://biocomplexity.virginia.edu/institute/divisions/social-and-decision-analytics" class="external-link">Biocomplexity Institute</a>, Micah Iserman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
